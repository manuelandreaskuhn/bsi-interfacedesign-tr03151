<?xml version='1.0' encoding='utf-8'?>
<function xmlns="http://bsi.bund.de/TR03151" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="getLastLogMessage" xsi:schemaLocation="http://bsi.bund.de/TR03151 ../../schema/functions.xsd">
  <name>getLastLogMessage</name>
  <category>Logging</category>
  <description>Reads a log message that bases on the last log message parts that have been produced and processed by the Secure Element</description>
  <detailedSteps>
    <step>
      <number>1</number>
      <originalText>If the referencing guideline limits the access to the functionality solely to authenticated users, the function SHALL check if the user that has invoked the function has the status authenticated. If the status is not authenticated, the function SHALL raise the exception ErrorUserNotAuthenticated and exit the function.</originalText>
      <germanText>Prüft, ob Nutzer authentifiziert. Falls nicht: Exception ErrorUserNotAuthenticated, Ende.</germanText>
      <pseudocode>WENN Benutzer NICHT authentifiziert DANN
  WERFE ErrorUserNotAuthenticated
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorUserNotAuthenticated</exception>
        <trigger>Der Benutzer ist nicht authentifiziert</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>2</number>
      <originalText>If the referencing guideline limits the access to the functionality to certain roles, the function SHALL check in the corresponding role if the (unauthenticated) user is authorized to execute the function. If the user is not authorized, the function SHALL raise the exception ErrorUserNotAuthorized and exit the function.</originalText>
      <germanText>Prüft, ob Nutzer berechtigt. Falls nicht: Exception ErrorUserNotAuthorized, Ende.</germanText>
      <pseudocode>WENN Benutzer NICHT autorisiert DANN
  WERFE ErrorUserNotAuthorized
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorUserNotAuthorized</exception>
        <trigger>Der Benutzer ist nicht berechtigt</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>3</number>
      <originalText>The function SHALL retrieve the parts of the log message determined by the Secure Element most recently. If no log message parts are found in the Secure Element, the exception ErrorNoLogMessageFound SHALL be raised and the function SHALL be exited. If the retrieving of the log message parts fails, the exception ErrorReadingLogMessage SHALL be raised and the function SHALL be exited.</originalText>
      <germanText>Holt letzte Log-Teile vom Secure Element. Falls keine: Exception ErrorNoLogMessageFound. Bei Fehler: Exception ErrorReadingLogMessage.</germanText>
      <pseudocode>VERSUCHE
  HOLE letzte Log-Nachricht-Teile vom SE
BEI_FEHLER
  WENN keine Log-Teile gefunden DANN
    WERFE ErrorNoLogMessageFound
  SONST
    WERFE ErrorReadingLogMessage
  ENDE
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorNoLogMessageFound</exception>
        <trigger>Keine Log-Nachricht-Teile im SE gefunden</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>4</number>
      <originalText>The retrieved log message parts SHALL be combined into a complete log message. This log message SHALL be returned to the application over the output parameter logMessageContent and logMessageFileName. Additionally, the function SHALL return without raising an exception to indicate that the execution of the function has been successful.</originalText>
      <germanText>Setzt Log zusammen und gibt es zurück. Bei Erfolg keine Exception.</germanText>
      <pseudocode>KOMBINIERE Log-Nachricht-Teile zur vollständigen Log-Nachricht
GEBE Log zurück (logMessageContent Parameter)
GEBE Dateiname zurück (logMessageFileName Parameter)
RETURN ohne Exception</pseudocode>
      <successCase>
        <condition>Ausführung war erfolgreich</condition>
        <action>Funktion kehrt ohne Exception zurück</action>
      </successCase>
    </step>
  </detailedSteps>
  <parameters />
  <returnValue>
    <type>ExportDataResult</type>
    <description>an ExportDataResult which contains an InputStream delivering the content of the last log message and the filename of the log message.</description>
  </returnValue>
  <exceptions>
    <exception>ErrorDeviceNotInitialized</exception>
    <exception>ErrorFunctionFailed</exception>
    <exception>ErrorFunctionNotSupported</exception>
    <exception>ErrorNoLogMessageFound</exception>
    <exception>ErrorParameterSyntax</exception>
    <exception>ErrorReadingLogMessage</exception>
    <exception>ErrorSecureElementDisabled</exception>
    <exception>ErrorStorageMediumDisconnected</exception>
    <exception>ErrorUserNotAuthenticated</exception>
    <exception>ErrorUserNotAuthorized</exception>
  </exceptions>
</function>
