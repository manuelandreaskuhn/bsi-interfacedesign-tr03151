<?xml version='1.0' encoding='utf-8'?>
<function xmlns="http://bsi.bund.de/TR03151" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="exportFilteredTransactionLogs" xsi:schemaLocation="http://bsi.bund.de/TR03151 ../../schema/functions.xsd">
  <name>exportFilteredTransactionLogs</name>
  <category>Client- und Transaktionsverwaltung</category>
  <description>This function can be used to export the &lt;ul&gt; &lt;li&gt;log messages containing the certified data and protocol data,&lt;/li&gt; &lt;li&gt;certificates that are necessary for the verification of the log messages and&lt;/li&gt; &lt;li&gt;device information&lt;/li&gt; &lt;/ul&gt; possibly limited by maximumNumberRecords.</description>
  <detailedSteps>
    <step>
      <number>1</number>
      <originalText>If the referencing guideline limits the access to the functionality solely to authenticated users, the function SHALL check if the user that has invoked the function has the status authenticated. If the status is not authenticated, the function SHALL raise the exception ErrorUserNotAuthenticated and exit the function.</originalText>
      <germanText>Prüft, ob Nutzer authentifiziert. Falls nicht: Exception ErrorUserNotAuthenticated, Ende.</germanText>
      <pseudocode>WENN Benutzer NICHT authentifiziert DANN
  WERFE ErrorUserNotAuthenticated
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorUserNotAuthenticated</exception>
        <trigger>Der Benutzer ist nicht authentifiziert</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>2</number>
      <originalText>If the referencing guideline limits the access to the functionality to certain roles, the function SHALL check in the corresponding role if the (unauthenticated) user is authorized to execute the function. If the user is not authorized, the function SHALL raise the exception ErrorUserNotAuthorized and exit the function.</originalText>
      <germanText>Prüft, ob Nutzer berechtigt. Falls nicht: Exception ErrorUserNotAuthorized, Ende.</germanText>
      <pseudocode>WENN Benutzer NICHT autorisiert DANN
  WERFE ErrorUserNotAuthorized
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorUserNotAuthorized</exception>
        <trigger>Der Benutzer ist nicht berechtigt</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>3</number>
      <originalText>The function SHALL check the input parameters for validity. If any of the checks fails, the function SHALL raise the exception ErrorParameterMismatch and exit the function. This specifically includes the following checks:</originalText>
      <germanText>Prüft Eingabeparameter auf Gültigkeit. Bei Fehler: Exception ErrorParameterMismatch, Ende.</germanText>
      <pseudocode>VERSUCHE
  PRÜFE Eingabeparameter auf Gültigkeit
BEI_FEHLER
  WERFE ErrorParameterMismatch
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorParameterMismatch</exception>
        <trigger>Ein oder mehrere Eingabeparameter sind ungültig</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>4</number>
      <originalText>If transactionNumber has been provided, neither startDate nor endDate SHALL be provided.</originalText>
      <germanText>Wenn transactionNumber gesetzt, dann kein startDate oder endDate erlaubt.</germanText>
      <pseudocode>WENN transactionNumber gesetzt UND (startDate ODER endDate) gesetzt DANN
  WERFE ErrorParameterMismatch
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorParameterMismatch</exception>
        <trigger>transactionNumber und startDate/endDate wurden gleichzeitig bereitgestellt</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>5</number>
      <originalText>If firstTransactionNumber and lastTransactionNumber have been provided, neither startDate nor endDate SHALL be provided.</originalText>
      <germanText>Wenn firstTransactionNumber und lastTransactionNumber gesetzt, dann kein startDate oder endDate erlaubt.</germanText>
      <pseudocode>WENN (firstTransactionNumber ODER lastTransactionNumber) gesetzt UND (startDate ODER endDate) gesetzt DANN
  WERFE ErrorParameterMismatch
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorParameterMismatch</exception>
        <trigger>firstTransactionNumber/lastTransactionNumber und startDate/endDate wurden gleichzeitig bereitgestellt</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>6</number>
      <originalText>If firstTransactionNumber has been provided, lastTransactionNumber must have been provided as well and vice versa.</originalText>
      <germanText>firstTransactionNumber und lastTransactionNumber müssen gemeinsam gesetzt sein.</germanText>
      <pseudocode>WENN (firstTransactionNumber gesetzt UND lastTransactionNumber NICHT gesetzt) ODER (lastTransactionNumber gesetzt UND firstTransactionNumber NICHT gesetzt) DANN
  WERFE ErrorParameterMismatch
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorParameterMismatch</exception>
        <trigger>Nur eines von firstTransactionNumber oder lastTransactionNumber wurde bereitgestellt</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>7</number>
      <originalText>If provided, startDate and/or endDate MUST be valid date/time values.</originalText>
      <germanText>startDate und endDate müssen gültige Datums-/Zeitwerte sein.</germanText>
      <pseudocode>WENN (startDate gesetzt UND startDate ungültig) ODER (endDate gesetzt UND endDate ungültig) DANN
  WERFE ErrorParameterMismatch
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorParameterMismatch</exception>
        <trigger>startDate oder endDate sind keine gültigen Datums-/Zeitwerte</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>8</number>
      <originalText>If startDate and endDate have been provided, endDate MUST lay after startDate.</originalText>
      <germanText>Wenn startDate und endDate gesetzt, muss endDate nach startDate liegen.</germanText>
      <pseudocode>WENN (startDate gesetzt UND endDate gesetzt UND endDate &lt;= startDate) DANN
  WERFE ErrorParameterMismatch
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorParameterMismatch</exception>
        <trigger>endDate liegt nicht nach startDate</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>9</number>
      <originalText>If a startDate and/or endDate have been provided, transactionNumber MUST NOT be provided.</originalText>
      <germanText>Wenn startDate oder endDate gesetzt, darf transactionNumber nicht bereitgestellt sein.</germanText>
      <pseudocode>WENN (startDate ODER endDate) gesetzt UND transactionNumber gesetzt DANN
  WERFE ErrorParameterMismatch
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorParameterMismatch</exception>
        <trigger>startDate/endDate und transactionNumber wurden gleichzeitig bereitgestellt</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>10</number>
      <originalText>If clientId has been provided, only transactions should be exported, in which the clientId was involved. The device MAY export the complete transaction, or just the transaction log message files, where the clientId is identical to the provided one.</originalText>
      <germanText>Wenn clientId gesetzt, nur Transaktionen exportieren, in denen die clientId beteiligt war.</germanText>
      <pseudocode>WENN clientId gesetzt DANN
  FILTERUNG Transaktionen nach clientId
ENDE</pseudocode>
      <successCase>
        <condition>clientId ist gültig gesetzt</condition>
        <action>Transaktionen nach clientId filtern</action>
      </successCase>
    </step>
  </detailedSteps>
  <parameters>
    <parameter>
      <name>clientId</name>
      <type>String</type>
      <description>filter by client ID (optional, multiple overloaded versions exist).</description>
      <direction>INPUT</direction>
      <required>false</required>
    </parameter>
    <parameter>
      <name>transactionNumber</name>
      <type>long</type>
      <description>filter by transaction number (optional, multiple overloaded versions exist).</description>
      <direction>INPUT</direction>
      <required>false</required>
    </parameter>
    <parameter>
      <name>startDate</name>
      <type>ZonedDateTime</type>
      <description>filter by start date (optional, multiple overloaded versions exist).</description>
      <direction>INPUT</direction>
      <required>false</required>
    </parameter>
    <parameter>
      <name>endDate</name>
      <type>ZonedDateTime</type>
      <description>filter by end date (optional, multiple overloaded versions exist).</description>
      <direction>INPUT</direction>
      <required>false</required>
    </parameter>
    <parameter>
      <name>maximumNumberRecords</name>
      <type>int</type>
      <description>maximum number of records to return (optional, multiple overloaded versions exist).</description>
      <direction>INPUT</direction>
      <required>false</required>
    </parameter>
  </parameters>
  <returnValue>
    <type>ExportDataResult</type>
    <description>an ExportDataResult which contains an InputStream delivering a TAR archive with the filtered transaction log messages and certificates, and the filename of the TAR archive.</description>
  </returnValue>
  <note>This function has multiple overloaded versions with different parameter combinations.</note>
  <exceptions>
    <exception>ErrorClientIdNotFound</exception>
    <exception>ErrorDeviceNotInitialized</exception>
    <exception>ErrorFunctionFailed</exception>
    <exception>ErrorFunctionNotSupported</exception>
    <exception>ErrorNoDataAvailable</exception>
    <exception>ErrorParameterMismatch</exception>
    <exception>ErrorParameterSyntax</exception>
    <exception>ErrorParameterTooLong</exception>
    <exception>ErrorStorageMediumDisconnected</exception>
    <exception>ErrorTooManyRecords</exception>
    <exception>ErrorTransactionNumberNotFound</exception>
    <exception>ErrorUserNotAuthenticated</exception>
    <exception>ErrorUserNotAuthorized</exception>
  </exceptions>
</function>
