<?xml version='1.0' encoding='utf-8'?>
<function xmlns="http://bsi.bund.de/TR03151" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="getTransactionState" xsi:schemaLocation="http://bsi.bund.de/TR03151 ../../schema/functions.xsd">
  <name>getTransactionState</name>
  <category>Client- und Transaktionsverwaltung</category>
  <description>The function getTransactionState can be used to obtain the current state of a transaction.</description>
  <detailedSteps>
    <step>
      <number>1</number>
      <originalText>If the referencing guideline limits the access to the functionality solely to authenticated users, the function SHALL check if the user that has invoked the function has the status authenticated. If the status is not authenticated, the function SHALL raise the exception ErrorUserNotAuthenticated and exit the function.</originalText>
      <germanText>Falls die Richtlinie den Zugriff auf authentifizierte Benutzer beschränkt: Prüfe, ob der aufrufende Benutzer authentifiziert ist. Falls nicht: Werfe ErrorUserNotAuthenticated und beende Funktion.</germanText>
      <pseudocode>WENN Benutzer NICHT authentifiziert DANN
  WERFE ErrorUserNotAuthenticated
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorUserNotAuthenticated</exception>
        <trigger>Der Benutzer ist nicht authentifiziert</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>2</number>
      <originalText>If the referencing guideline limits the access to the functionality to certain roles, the function SHALL check in the corresponding role if the (unauthenticated) user is authorized to execute the function. If the user is not authorized, the function SHALL raise the exception ErrorUserNotAuthorized and exit the function.</originalText>
      <germanText>Falls die Richtlinie den Zugriff auf bestimmte Rollen beschränkt: Prüfe in der entsprechenden Rolle, ob der (unauthentifizierte) Benutzer berechtigt ist, die Funktion auszuführen. Falls nicht: Werfe ErrorUserNotAuthorized und beende Funktion.</germanText>
      <pseudocode>WENN Benutzer NICHT autorisiert DANN
  WERFE ErrorUserNotAuthorized
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorUserNotAuthorized</exception>
        <trigger>Der Benutzer ist nicht berechtigt</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>3</number>
      <originalText>The function getTransactionState SHALL determine the current state of the transaction identified by the passed parameter transactionNumber. If the passed transaction number is not managed by the device the function SHALL raise the exception ErrorTransactionNumberNotFound and exit the function.</originalText>
      <germanText>Funktion ermittelt aktuellen Transaktionsstatus mit übergebener Transaktionsnummer. Falls Transaktionsnummer nicht vorhanden: ErrorTransactionNumberNotFound, Ende.</germanText>
      <pseudocode>VERSUCHE
  HOLE Transaktionsstatus mit Transaktionsnummer
BEI_FEHLER
  WERFE ErrorTransactionNumberNotFound
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorTransactionNumberNotFound</exception>
        <trigger>Transaktionsnummer nicht gefunden</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>4</number>
      <originalText>If the determination of transaction state fails, the function SHALL raise the exception ErrorGetTransactionStateFailed and exit the function.</originalText>
      <germanText>Falls die Ermittlung des Transaktionsstatus schlägt fehl: Werfe ErrorGetTransactionStateFailed und beende Funktion.</germanText>
      <pseudocode>WENN Operation fehlgeschlagen DANN
  WERFE ErrorGetTransactionStateFailed
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorGetTransactionStateFailed</exception>
        <trigger>Die Ermittlung des Transaktionsstatus schlägt fehl</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>5</number>
      <originalText>If the determination of transaction state has been successful, the function SHALL return the information regarding the state by the output parameter transactionState. Additionally, the function SHALL return without raising an exception to indicate that the execution of the function has been successful.</originalText>
      <germanText>Bei Erfolg der Ermittlung: Gibt Transaktionsstatus via Parameter transactionState zurück. Keine Exception.</germanText>
      <pseudocode>GEBE Transaktionsstatus zurück (transactionState Parameter)
RETURN ohne Exception</pseudocode>
      <successCase>
        <condition>Ermittlung des Transaktionsstatus erfolgreich</condition>
        <action>Gibt Transaktionsstatus via Parameter zurück</action>
      </successCase>
    </step>
  </detailedSteps>
  <parameters>
    <parameter>
      <name>transactionNumber</name>
      <type>long</type>
      <description>parameter is used to unambiguously identify the transaction.</description>
      <direction>INPUT</direction>
      <required>true</required>
    </parameter>
  </parameters>
  <returnValue>
    <type>TransactionState</type>
    <description>the current state of the transaction (started, updated, updatedWithUnprotectedData, finished, or abandoned).</description>
  </returnValue>
  <exceptions>
    <exception>ErrorDeviceNotInitialized</exception>
    <exception>ErrorFunctionFailed</exception>
    <exception>ErrorFunctionNotSupported</exception>
    <exception>ErrorGetTransactionStateFailed</exception>
    <exception>ErrorParameterSyntax</exception>
    <exception>ErrorSecureElementDisabled</exception>
    <exception>ErrorStorageMediumDisconnected</exception>
    <exception>ErrorTransactionNumberNotFound</exception>
    <exception>ErrorUserNotAuthenticated</exception>
    <exception>ErrorUserNotAuthorized</exception>
  </exceptions>
</function>
