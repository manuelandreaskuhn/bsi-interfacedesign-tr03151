<?xml version='1.0' encoding='utf-8'?>
<function id="configureLogging" xmlns="http://bsi.bund.de/TR03151" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://bsi.bund.de/TR03151 ../../schema/functions.xsd">
  <name>configureLogging</name>
  <category>Logging</category>
  <description>The function configureLogging can be used to enable and disable the logging of specific events.</description>
  <detailedSteps>
    <step>
      <number>1</number>
      <originalText>If the referencing guideline limits the access to the functionality solely to authenticated users, the function SHALL check if the user that has invoked the function has the status authenticated. If the status is not authenticated, the function SHALL raise the exception ErrorUserNotAuthenticated and exit the function.</originalText>
      <germanText>Prüft, ob Nutzer authentifiziert. Falls nicht: Exception ErrorUserNotAuthenticated, Ende.</germanText>
      <pseudocode>WENN Benutzer NICHT authentifiziert DANN
  WERFE ErrorUserNotAuthenticated
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorUserNotAuthenticated</exception>
        <trigger>Der Benutzer ist nicht authentifiziert</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>2</number>
      <originalText>If the referencing guideline limits the access to the functionality to certain roles, the function SHALL check in the corresponding role if the (unauthenticated) user is authorized to execute the function. If the user is not authorized, the function SHALL raise the exception ErrorUserNotAuthorized and exit the function.</originalText>
      <germanText>Prüft, ob Nutzer berechtigt. Falls nicht: Exception ErrorUserNotAuthorized, Ende.</germanText>
      <pseudocode>WENN Benutzer NICHT autorisiert DANN
  WERFE ErrorUserNotAuthorized
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorUserNotAuthorized</exception>
        <trigger>Der Benutzer ist nicht berechtigt</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>3</number>
      <originalText>If a referencing guideline prohibits the usage of the function after the initialization and the device is already initialized, the function SHALL raise the exeception ErrorDeviceIsInitialized and exit the function.</originalText>
      <germanText>Falls nach Initialisierung verboten und Gerät initialisiert: Exception ErrorDeviceIsInitialized, Ende.</germanText>
      <pseudocode>WENN Richtlinie verbietet nach Initialisierung UND Gerät initialisiert DANN
  WERFE ErrorDeviceIsInitialized
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorDeviceIsInitialized</exception>
        <trigger>Das Gerät ist bereits initialisiert</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>4</number>
      <originalText>The function SHALL check if the logging of the event specified by the function input parameter eventName in the component specified by function input parameter componentName is configurable. If the logging of the event is not configurable, the function SHALL raise the exception ErrorLoggingOfEventNotConfigurable and exit the function.</originalText>
      <germanText>Prüft, ob Logging für Event/Komp. konfigurierbar. Falls nicht: Exception ErrorLoggingOfEventNotConfigurable, Ende.</germanText>
      <pseudocode>WENN Logging für Event/Komponente NICHT konfigurierbar DANN
  WERFE ErrorLoggingOfEventNotConfigurable
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorLoggingOfEventNotConfigurable</exception>
        <trigger>Das Logging für das angegebene Event ist nicht konfigurierbar</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>5</number>
      <originalText>The function SHALL set the logging of the event specified by the function input parameter eventName in the component specified by function input parameter componentName to the value of the boolean input parameter eventEnabled. If the execution fails, the function SHALL raise the exception ErrorConfigureLoggingFailed and exit the function.</originalText>
      <germanText>Setzt Logging für Event/Komp. auf eventEnabled. Bei Fehler: Exception ErrorConfigureLoggingFailed, Ende.</germanText>
      <pseudocode>VERSUCHE
  SETZE Logging auf eventEnabled
BEI_FEHLER
  WERFE ErrorConfigureLoggingFailed
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorConfigureLoggingFailed</exception>
        <trigger>Die Ausführung schlägt fehl</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>6</number>
      <originalText>The function SHALL invoke the functionality of the Secure Element to create the log message parts to log the logging configuration and to pass the relevant data to the Secure Element. If the execution fails, the function SHALL raise the exception ErrorSigningEventDataFailed and exit the function.</originalText>
      <germanText>Ruft SE-Funktionalität auf, um Log-Nachricht-Teile für Konfigurationsereignisse zu erstellen. Bei Fehler: Exception ErrorSigningEventDataFailed, Ende.</germanText>
      <pseudocode>VERSUCHE
  RUFE_AUF SE.erstelle_Log_Nachricht_Teile
BEI_FEHLER
  WERFE ErrorSigningEventDataFailed
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorSigningEventDataFailed</exception>
        <trigger>Die Ausführung schlägt fehl</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>7</number>
      <originalText>The function SHALL retrieve the parts of the log message determined by the Secure Element. If the execution of this function fails, the function SHALL raise the exception ErrorRetrieveLogMessageFailed and exit the function.</originalText>
      <germanText>Holt die Log-Nachricht-Teile vom SE ab. Bei Fehler: Exception ErrorRetrieveLogMessageFailed, Ende.</germanText>
      <pseudocode>VERSUCHE
  HOLE Log-Nachricht-Teile vom SE
BEI_FEHLER
  WERFE ErrorRetrieveLogMessageFailed
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorRetrieveLogMessageFailed</exception>
        <trigger>Die Ausführung dieser Funktion schlägt fehl</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>8</number>
      <originalText>The data sent to the Secure Element and the data of the log message parts retrieved from the Secure Element (together forming the log message contents) SHALL be stored. If the data has not been stored successfully, the function SHALL raise the exception ErrorStoringLogMessageFailed and exit the function.</originalText>
      <germanText>Speichert Daten und Log-Teile. Bei Fehler: Exception ErrorStoringLogMessageFailed, Ende.</germanText>
      <pseudocode>VERSUCHE
  SPEICHERE Daten und Log-Teile
BEI_FEHLER
  WERFE ErrorStoringLogMessageFailed
  BEENDE_FUNKTION
ENDE</pseudocode>
      <errorCase>
        <exception>ErrorStoringLogMessageFailed</exception>
        <trigger>Die Daten wurden nicht erfolgreich gespeichert</trigger>
        <action>Funktion beenden</action>
      </errorCase>
    </step>
    <step>
      <number>9</number>
      <originalText>The function SHALL return without raising an exception to indicate that the execution of the function has been successful.</originalText>
      <germanText>Gebe ohne Exception zurück, um die erfolgreiche Ausführung anzuzeigen.</germanText>
      <pseudocode>// Erfolgsfall
Funktion kehrt ohne Exception zurück
BEENDE_ERFOLGREICH</pseudocode>
      <successCase>
        <condition>Ausführung war erfolgreich</condition>
        <action>Funktion kehrt ohne Exception zurück</action>
      </successCase>
    </step>
  </detailedSteps>
  <parameters>
    <parameter>
      <name>componentName</name>
      <type>String</type>
      <description>the name of the component for which logging is configured.</description>
      <direction>INPUT</direction>
      <required>true</required>
    </parameter>
    <parameter>
      <name>eventname</name>
      <type>String</type>
      <description>the name of the event to be configured.</description>
      <direction>INPUT</direction>
      <required>true</required>
    </parameter>
    <parameter>
      <name>eventEnabled</name>
      <type>boolean</type>
      <description>indicates whether the event logging should be enabled or disabled.</description>
      <direction>INPUT</direction>
      <required>true</required>
    </parameter>
  </parameters>
  <returnValue>
    <type>void</type>
    <description>This function does not return a value.</description>
  </returnValue>
  <exceptions>
    <exception>ErrorCertificateExpired</exception>
    <exception>ErrorConfigureLoggingFailed</exception>
    <exception>ErrorDeviceIsInitialized</exception>
    <exception>ErrorDeviceNotInitialized</exception>
    <exception>ErrorFunctionFailed</exception>
    <exception>ErrorFunctionNotSupported</exception>
    <exception>ErrorLoggingOfEventNotConfigurable</exception>
    <exception>ErrorParameterSyntax</exception>
    <exception>ErrorParameterTooLong</exception>
    <exception>ErrorRetrieveLogMessageFailed</exception>
    <exception>ErrorSecureElementDisabled</exception>
    <exception>ErrorSecureElementPartsDisconnected</exception>
    <exception>ErrorSignatureCounterExhausted</exception>
    <exception>ErrorSignatureCounterOverflow</exception>
    <exception>ErrorSigningEventDataFailed</exception>
    <exception>ErrorStorageMediumDisconnected</exception>
    <exception>ErrorStorageMemoryFull</exception>
    <exception>ErrorStoringLogMessageFailed</exception>
    <exception>ErrorUserNotAuthenticated</exception>
    <exception>ErrorUserNotAuthorized</exception>
  </exceptions>
  <systemLog>
    <logType>system</logType>
    <requirement>MUST</requirement>
    <asn1Structure>
      <logMessage>LogMessage ::= SEQUENCE {
  version                INTEGER (3),
  certifiedDataType      OBJECT IDENTIFIER (id-SE-API-system-log),
  certifiedData          SystemLogMessage,  -- embedded system log
  serialNumber           OCTET STRING (SIZE (32)),
  signatureAlgorithm     AlgorithmIdentifier,
  seAuditData            OCTET STRING OPTIONAL,
  signatureCounter       INTEGER,
  signatureCreationTime  Time,
  signatureValue         OCTET STRING
}</logMessage>
      <systemLogMessage>SystemLogMessage ::= SEQUENCE {
  version                    INTEGER (3),
  certifiedDataType          OBJECT IDENTIFIER (id-SE-API-system-log),
  eventType                  [0] IMPLICIT PrintableString ("configureLogging"),
  eventOrigin                [1] IMPLICIT PrintableString OPTIONAL,
  eventTriggeredByUser       [2] IMPLICIT UserId OPTIONAL,
  eventData                  [3] IMPLICIT ConfigureLoggingEventData,
  additionalInternalData     [4] IMPLICIT OCTET STRING OPTIONAL,
  serialNumber               OCTET STRING (SIZE (32)),
  signatureAlgorithm         AlgorithmIdentifier,
  signatureCounter           INTEGER,
  signatureCreationTime      Time,
  signatureValue             OCTET STRING
}

ConfigureLoggingEventData ::= SEQUENCE {
    configuredComponents  ConfiguredComponents
}</systemLogMessage>
    </asn1Structure>
    <structure>
      <field>
        <name>version</name>
        <type>INTEGER (3)</type>
        <required>true</required>
        <defaultValue>3</defaultValue>
        <description>Version of the log message format. SHALL be set to '3'.</description>
        <origin>Provided by the device</origin>
      </field>
      <field>
        <name>certifiedDataType</name>
        <type>OBJECT IDENTIFIER</type>
        <required>true</required>
        <defaultValue>id-SE-API-system-log</defaultValue>
        <description>MUST be set to the OID id-SE-API-system-log.</description>
        <origin>Provided by the device</origin>
      </field>
      <field>
        <name>eventType</name>
        <type>PrintableString</type>
        <tag>[0] IMPLICIT</tag>
        <required>true</required>
        <defaultValue>configureLogging</defaultValue>
        <description>MUST be set to 'configureLogging'.</description>
        <origin>Provided by the device</origin>
      </field>
      <field>
        <name>eventOrigin</name>
        <type>PrintableString</type>
        <tag>[1] IMPLICIT</tag>
        <required>false</required>
        <description>Component that triggered the event (e.g., component name).</description>
        <origin>Provided by the device</origin>
      </field>
      <field>
        <name>eventTriggeredByUser</name>
        <type>UserId</type>
        <tag>[2] IMPLICIT</tag>
        <required>false</required>
        <description>User ID of the user that triggered the event.</description>
        <origin>Provided by the device</origin>
      </field>
      <field>
        <name>eventData</name>
        <type>ConfigureLoggingEventData</type>
        <tag>[3] IMPLICIT</tag>
        <required>true</required>
        <description>Function-specific event data.</description>
        <origin>Provided by the device</origin>
      </field>
      <field>
        <name>additionalInternalData</name>
        <type>OCTET STRING</type>
        <tag>[4] IMPLICIT</tag>
        <required>false</required>
        <description>MUST NOT be present. Reserved for future use.</description>
        <note>RFU</note>
        <origin>-</origin>
      </field>
      <field>
        <name>serialNumber</name>
        <type>OCTET STRING (SIZE (32))</type>
        <required>true</required>
        <description>Serial number of the Secure Element consisting of the hash value of the public key of the certificate used to verify system logs.</description>
        <origin>Provided by the device</origin>
      </field>
      <field>
        <name>signatureAlgorithm</name>
        <type>AlgorithmIdentifier</type>
        <required>true</required>
        <description>Information about the signature creation.</description>
        <origin>Provided by the device</origin>
      </field>
      <field>
        <name>signatureCounter</name>
        <type>INTEGER</type>
        <required>true</required>
        <description>Current count of signatures created with the log message signing key protected by the Secure Element.</description>
        <origin>Provided by the Secure Element</origin>
      </field>
      <field>
        <name>signatureCreationTime</name>
        <type>Time</type>
        <required>true</required>
        <description>Point in time of the Secure Element when the log message was signed.</description>
        <origin>Provided by the Secure Element</origin>
      </field>
      <field>
        <name>signatureValue</name>
        <type>OCTET STRING</type>
        <required>true</required>
        <description>Result of the signature computation encoded as octet string.</description>
        <origin>Provided by the Secure Element</origin>
      </field>
    </structure>
  </systemLog>
</function>
