<?xml version='1.0' encoding='utf-8'?>
<function xmlns="http://bsi.bund.de/TR03151" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="exportLogMessages" xsi:schemaLocation="http://bsi.bund.de/TR03151 ../../schema/functions.xsd">
  <name>exportLogMessages</name>
  <category>Logging</category>
  <description>
    <text xml:lang="en">This function is used to export &lt;ul&gt; &lt;li&gt;&lt;u&gt;all&lt;/u&gt; signed log messages,&lt;/li&gt; &lt;li&gt;certificates that are necessary for the verification of the log messages and&lt;/li&gt; &lt;li&gt;the device information.&lt;/li&gt; &lt;/ul&gt;</text>
    <text xml:lang="de">Diese Funktion wird verwendet, um alle signierten Log-Nachrichten, erforderliche Zertifikate zur Überprüfung und Geräteinformationen zu exportieren.</text>
  </description>
  <detailedSteps>
    <step>
      <number>1</number>
      <description>
        <text xml:lang="en">If the referencing guideline limits the access to the functionality solely to authenticated users, the function SHALL check if the user that has invoked the function has the status authenticated. If the status is not authenticated, the function SHALL raise the exception ErrorUserNotAuthenticated and exit the function.</text>
        <text xml:lang="de">Prüft, ob Nutzer authentifiziert. Falls nicht: Exception ErrorUserNotAuthenticated, Ende.</text>
      </description>
      <pseudocode>
        <text xml:lang="en">IF user NOT authenticated THEN
  RAISE ErrorUserNotAuthenticated
  EXIT_FUNCTION
END</text>
        <text xml:lang="de">WENN Benutzer NICHT authentifiziert DANN
  WERFE ErrorUserNotAuthenticated
  BEENDE_FUNKTION
ENDE</text>
      </pseudocode>
      <errorCase>
        <exception>ErrorUserNotAuthenticated</exception>
        <trigger>
          <text xml:lang="en">The user is not authenticated</text>
          <text xml:lang="de">Der Benutzer ist nicht authentifiziert</text>
        </trigger>
        <action>
          <text xml:lang="en">Exit the function</text>
          <text xml:lang="de">Funktion beenden</text>
        </action>
      </errorCase>
    </step>
    <step>
      <number>2</number>
      <description>
        <text xml:lang="en">If the referencing guideline limits the access to the functionality to certain roles, the function SHALL check in the corresponding role if the (unauthenticated) user is authorized to execute the function. If the user is not authorized, the function SHALL raise the exception ErrorUserNotAuthorized and exit the function.</text>
        <text xml:lang="de">Prüft, ob Nutzer berechtigt. Falls nicht: Exception ErrorUserNotAuthorized, Ende.</text>
      </description>
      <pseudocode>
        <text xml:lang="en">IF user NOT authorized THEN
  RAISE ErrorUserNotAuthorized
  EXIT_FUNCTION
END</text>
        <text xml:lang="de">WENN Benutzer NICHT autorisiert DANN
  WERFE ErrorUserNotAuthorized
  BEENDE_FUNKTION
ENDE</text>
      </pseudocode>
      <errorCase>
        <exception>ErrorUserNotAuthorized</exception>
        <trigger>
          <text xml:lang="en">The user is not authorized</text>
          <text xml:lang="de">Der Benutzer ist nicht berechtigt</text>
        </trigger>
        <action>
          <text xml:lang="en">Exit the function</text>
          <text xml:lang="de">Funktion beenden</text>
        </action>
      </errorCase>
    </step>
    <step>
      <number>3</number>
      <description>
        <text xml:lang="en">If no data is available, the function SHALL raise the exception ErrorNoDataAvailable and exit the function.</text>
        <text xml:lang="de">Prüft, ob Daten vorhanden. Falls nicht: Exception ErrorNoDataAvailable, Ende.</text>
      </description>
      <pseudocode>
        <text xml:lang="en">IF no data available THEN
  RAISE ErrorNoDataAvailable
  EXIT_FUNCTION
END</text>
        <text xml:lang="de">WENN keine Daten vorhanden DANN
  WERFE ErrorNoDataAvailable
  BEENDE_FUNKTION
ENDE</text>
      </pseudocode>
      <errorCase>
        <exception>ErrorNoDataAvailable</exception>
        <trigger>
          <text xml:lang="en">No data is available</text>
          <text xml:lang="de">Keine Daten vorhanden</text>
        </trigger>
        <action>
          <text xml:lang="en">Exit the function</text>
          <text xml:lang="de">Funktion beenden</text>
        </action>
      </errorCase>
    </step>
    <step>
      <number>4</number>
      <description>
        <text xml:lang="en">The function SHALL return all the stored data (as an output parameter) by exportLogMessages. The function SHALL return the file name for the TAR archive by fileName. Additionally, the function SHALL return without raising an exception to indicate that the execution of the function has been successful.</text>
        <text xml:lang="de">Gibt alle Daten und Dateinamen zurück. Bei Erfolg keine Exception.</text>
      </description>
      <pseudocode>
        <text xml:lang="en">RETURN all data in TAR archive (exportLogMessages parameter)
RETURN filename of TAR archive (fileName parameter)
RETURN without exception</text>
        <text xml:lang="de">GEBE alle Daten als TAR-Archiv zurück (exportLogMessages Parameter)
GEBE Dateinamen des TAR-Archivs zurück (fileName Parameter)
RETURN ohne Exception</text>
      </pseudocode>
      <successCase>
        <condition>
          <text xml:lang="en">Execution was successful</text>
          <text xml:lang="de">Ausführung war erfolgreich</text>
        </condition>
        <action>
          <text xml:lang="en">Function returns without exception</text>
          <text xml:lang="de">Funktion kehrt ohne Exception zurück</text>
        </action>
      </successCase>
    </step>
  </detailedSteps>
  <parameters />
  <returnValue>
    <type>ExportDataResult</type>
    <description>
      <text xml:lang="en">An ExportDataResult which contains an InputStream delivering a TAR archive with the log messages and certificates, and the filename of the TAR archive.</text>
      <text xml:lang="de">Ein ExportDataResult, das einen InputStream mit einem TAR-Archiv enthält, das die Log-Nachrichten und Zertifikate enthält, und den Dateinamen des TAR-Archivs.</text>
    </description>
  </returnValue>
  <exceptions>
    <exception>ErrorDeviceNotInitialized</exception>
    <exception>ErrorFunctionFailed</exception>
    <exception>ErrorFunctionNotSupported</exception>
    <exception>ErrorNoDataAvailable</exception>
    <exception>ErrorParameterSyntax</exception>
    <exception>ErrorStorageMediumDisconnected</exception>
    <exception>ErrorUserNotAuthenticated</exception>
    <exception>ErrorUserNotAuthorized</exception>
  </exceptions>
</function>
