flowchart TD
    Start([Kunde: Einkauf beginnen])
    Start --> StartTx[Kassensystem: startTransaction<br/>processData: leer<br/>processType: leer]
    
    StartTx --> StartTSE[TSE: Transaktion starten<br/>Transaktionsnummer erstellen]
    StartTSE --> TxNumber[Transaktionsnummer erhalten]
    
    TxNumber --> Scan[Artikel scannen/<br/>Preise erfassen]
    Scan --> MoreItems{Weitere<br/>Artikel?}
    
    MoreItems -->|Ja| Scan
    MoreItems -->|Nein| Payment[Kunde: Zahlungsart wählen]
    
    Payment --> Prepare[Kassensystem:<br/>processData vorbereiten<br/>Format: Vorgangstyp^Steuern^Zahlungen]
    
    Prepare --> Example["Beispiel:<br/>Beleg^10.50_2.30_0.00_0.00_0.00^12.80:Bar"]
    
    Example --> FinishTx["Kassensystem: finishTransaction<br/>processData: KassenbelegV1Data<br/>processType: Kassenbeleg-V1"]
    
    FinishTx --> FinishTSE[TSE: Transaktion abschließen<br/>Signatur erstellen]
    
    FinishTSE --> SaveLog[Speichere Transaction-Log]
    
    SaveLog --> GenQR[Generiere QR-Code<br/>mit Signaturdaten]
    
    GenQR --> PrintReceipt[Drucke Beleg<br/>mit QR-Code]
    
    PrintReceipt --> End([Ende])
    
    style StartTx fill:#e1f5ff
    style FinishTx fill:#e1f5ff
    style Example fill:#fff4e1
    style GenQR fill:#e8f5e9
    
    Note1[Hinweis: Bei Kassenbeleg-V1<br/>wird updateTransaction<br/>NICHT verwendet]
    
    style Note1 fill:#ffebee
