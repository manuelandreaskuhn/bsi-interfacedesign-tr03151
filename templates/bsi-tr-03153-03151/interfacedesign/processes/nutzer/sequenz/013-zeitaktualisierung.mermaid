sequenceDiagram
    participant Admin as Admin/TimeAdmin
    participant TSE as TSE
    participant SM as Sicherheitsmodul
    participant Speicher as Speichermedium
    participant NTP as NTP-Server (optional)

    Admin->>TSE: Anmeldung als admin/timeadmin
    TSE-->>Admin: Anmeldung erfolgreich
    
    opt Automatische Zeitsynchronisation
        TSE->>NTP: Hole aktuelle Zeit
        NTP-->>TSE: Aktuelle Zeit (UTC)
    end
    
    Admin->>TSE: updateTime(newTime)
    activate TSE
    
    Note over TSE: Prüfe: admin oder timeadmin<br/>authentifiziert
    
    TSE->>TSE: Validiere newTime:<br/>- Format korrekt?<br/>- Plausibilität
    
    TSE->>SM: Setze neue Zeit
    activate SM
    SM->>SM: Aktualisiere interne Uhr
    SM->>SM: oldTime = currentTime
    SM->>SM: currentTime = newTime
    SM-->>TSE: OK
    deactivate SM
    
    TSE->>SM: Erstelle updateTime System-Log
    activate SM
    SM->>SM: Log-Daten:<br/>- oldTime<br/>- newTime<br/>- eventTriggeredByUser
    SM->>SM: signatureCounter++
    SM->>SM: Erstelle Signatur mit newTime
    SM-->>TSE: Log-Nachricht + Signatur
    deactivate SM
    
    TSE->>Speicher: Speichere updateTime Log
    activate Speicher
    Speicher-->>TSE: OK
    deactivate Speicher
    
    TSE-->>Admin: Zeitaktualisierung erfolgreich
    deactivate TSE
    
    Note over Admin,Speicher: Alle nachfolgenden Signaturen<br/>verwenden die neue Zeit
