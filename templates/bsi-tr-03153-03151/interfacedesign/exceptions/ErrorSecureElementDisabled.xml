<?xml version='1.0' encoding='UTF-8' standalone='yes'?>
<exception xmlns="http://bsi.bund.de/TR03151" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="ErrorSecureElementDisabled" xsi:schemaLocation="http://bsi.bund.de/TR03151 ../../schema/exceptions.xsd">
  <name>ErrorSecureElementDisabled</name>
  <description>This exception is thrown if SE API functions are invoked which require an active and enabled Secure Element, but the Secure Element has been disabled. A disabled Secure Element cannot execute any SE API operations that require cryptographic operations, authentication, logging, transactions, or other core functionality. The Secure Element is typically disabled through administrative action (disable operation) or due to security policy. ErrorSecureElementDisabled indicates that the requested operation cannot proceed because the device is not in the enabled state required for operation. All state-changing operations and data access operations require an enabled Secure Element.</description>
  <category>Secure Element State - Device Disabled</category>
  <severity>Critical</severity>
  <thrownBy>
    <function>authenticateUser</function>
    <function>configureLogging</function>
    <function>deleteLogMessages</function>
    <function>deregisterClient</function>
    <function>disableSecureElement</function>
    <function>finishTransaction</function>
    <function>getComponentVersions</function>
    <function>getCurrentLoggingSignatureCounters</function>
    <function>getCurrentNumberOfClients</function>
    <function>getCurrentNumberOfTransactions</function>
    <function>getCurrentSeTime</function>
    <function>getCurrentTransactionCounter</function>
    <function>getEndOfUsageDate</function>
    <function>getLastLogMessage</function>
    <function>getLastTransactionLogMessage</function>
    <function>getMaxNumberOfClients</function>
    <function>getMaxNumberOfTransactions</function>
    <function>getOpenTransactions</function>
    <function>getRegisteredClients</function>
    <function>getSupportedTransactionUpdateVariants</function>
    <function>getTimeSyncVariant</function>
    <function>getTransactionState</function>
    <function>initialize</function>
    <function>lockTransactionLogging</function>
    <function>logOut</function>
    <function>registerClient</function>
    <function>selfTest</function>
    <function>setDescription</function>
    <function>startTransaction</function>
    <function>unblockPin</function>
    <function>unlockTransactionLogging</function>
    <function>updateDevice</function>
    <function>updateTime</function>
    <function>updateTransaction</function>
  </thrownBy>
  <javadoc>
    <summary>This class defines the exception ErrorSecureElementDisabled that is thrown if SE API operations are invoked on a disabled Secure Element.</summary>
    <description>This exception is thrown when SE API functions requiring an active Secure Element are called but the device is disabled. A disabled Secure Element cannot perform cryptographic operations, authentication, transaction processing, logging, or device operations. ErrorSecureElementDisabled indicates that the device is not in the operational state required for the requested function. Common reasons for disabled state include: administrative disable operation, security policy enforcement, device deactivation, or lifecycle management. ErrorSecureElementDisabled is a Critical severity exception because it blocks all SE API operations. The device must be re-enabled before operations can resume. Recovery requires administrative intervention or security policy updates. All functions that require an active Secure Element will raise this exception if the device is disabled.</description>
    <constructors>
      <constructor>
        <signature>ErrorSecureElementDisabled()</signature>
        <description>Constructs a new ErrorSecureElementDisabled exception with null as the value for its detail message</description>
      </constructor>
      <constructor>
        <signature>ErrorSecureElementDisabled(String message)</signature>
        <description>Constructs a new ErrorSecureElementDisabled exception whereby its detail message is initialized with the passed value</description>
        <parameter name="message">value for the detail message of the exception, typically describing which Secure Element is disabled</parameter>
      </constructor>
      <constructor>
        <signature>ErrorSecureElementDisabled(String message, Throwable cause)</signature>
        <description>Constructs a new ErrorSecureElementDisabled exception whereby its detail message and cause are initialized with the appropriate passed values</description>
        <parameter name="message">value for the detail message of the exception</parameter>
        <parameter name="cause">value for the cause of the exception</parameter>
      </constructor>
      <constructor>
        <signature>ErrorSecureElementDisabled(String message, Throwable cause, boolean enableSuppression, boolean writableStackTrace)</signature>
        <description>Constructs a new ErrorSecureElementDisabled exception whereby its detail message and cause are initialized with the appropriate passed values. Furthermore, it is specified whether or not suppression should be enabled or disabled and whether or not the stack trace should be writable for this exception.</description>
        <parameter name="message">value for the detail message of the exception</parameter>
        <parameter name="cause">value for the cause of the exception</parameter>
        <parameter name="enableSuppression">specifies whether or not suppression should be enabled for this exception</parameter>
        <parameter name="writableStackTrace">specifies whether or not the stack trace should be writable for this exception</parameter>
      </constructor>
    </constructors>
  </javadoc>
  <specification>
    <source>BSI TR-03151-1</source>
    <section>3.2.1 Secure Element State Management and 3.3 SE API Functions - General Requirements</section>
    <requirement>The Secure Element can be in enabled or disabled state. When disabled, the Secure Element cannot execute SE API operations that require active processing. Any SE API function requiring an enabled Secure Element SHALL raise ErrorSecureElementDisabled if invoked on a disabled device. The disabled state is typically set through administrative action or security policy. The device must be explicitly enabled to resume normal operations. All cryptographic operations, authentication, transaction processing, logging, and data operations require an enabled Secure Element.</requirement>
    <applicability>All SE API functions requiring an active Secure Element: authenticateUser, logOut, unblockPin, setDescription, selfTest, updateDevice, updateTime, getCurrentSeTime, configureLogging, exportLogMessages, registerClient, deregisterClient, startTransaction, updateTransaction, finishTransaction, lockTransactionLogging, unlockTransactionLogging</applicability>
    <reference>Secure Element State Management (3.2.1)</reference>
  </specification>
  <triggerConditions>
    <condition>
      <scenario>Secure Element administratively disabled</scenario>
      <description>The Secure Element has been disabled through administrative action or management interface</description>
      <trigger>Any SE API function requiring an active Secure Element is called. The device checks its enabled/disabled state and detects disabled state. The function raises ErrorSecureElementDisabled.</trigger>
    </condition>
    <condition>
      <scenario>Device disabled by security policy</scenario>
      <description>The Secure Element is disabled due to security policy enforcement or security event</description>
      <trigger>A SE API function is called but security policy evaluation indicates the device must be disabled. The function raises ErrorSecureElementDisabled.</trigger>
    </condition>
    <condition>
      <scenario>Device in lifecycle deactivation state</scenario>
      <description>The Secure Element is in a deactivation or end-of-life state</description>
      <trigger>Any SE API function is called but the device is in deactivation state (disabled for lifecycle reasons). The function raises ErrorSecureElementDisabled.</trigger>
    </condition>
    <condition>
      <scenario>Device initialization incomplete or pending</scenario>
      <description>The Secure Element has not been fully initialized or is in initialization pending state</description>
      <trigger>An SE API function is called but the device initialization is not complete. The function checks device state and raises ErrorSecureElementDisabled.</trigger>
    </condition>
    <condition>
      <scenario>Device recovery from error state</scenario>
      <description>The Secure Element is temporarily disabled during recovery from an error or critical event</description>
      <trigger>An SE API function is called during device error recovery when the device must be disabled for safety. The function raises ErrorSecureElementDisabled.</trigger>
    </condition>
  </triggerConditions>
  <executionSequence>
    <step number="1">User/application calls an SE API function that requires an enabled Secure Element (e.g., authenticateUser)</step>
    <step number="2">Function validates input parameters</step>
    <step number="3">Function checks Secure Element state (enabled/disabled)</step>
    <step number="3a">If Secure Element is disabled → ErrorSecureElementDisabled raised, function exits immediately</step>
    <step number="3b">If Secure Element is enabled → proceed to step 4</step>
    <step number="4">Function initiates communication with Secure Element</step>
    <step number="5">Function sends operation request to Secure Element</step>
    <step number="6">Secure Element receives request and validates its operational state</step>
    <step number="7">Secure Element executes requested operation</step>
    <step number="8">Secure Element returns result to function</step>
    <step number="9">Function processes result and returns to caller</step>
  </executionSequence>
  <recovery>
    <step>Review error message - understand why the Secure Element is disabled</step>
    <step>Check device state - query device status to confirm it is disabled</step>
    <step>Verify administrative policy - check if device disable is intentional or policy-based</step>
    <step>Contact administrator - request re-enabling of the Secure Element if disable was unintended</step>
    <step>Check security alerts - verify no security events caused the disable</step>
    <step>Enable the Secure Element - use management interface or administrative API to enable device</step>
    <step>Verify device re-enabled - query device state to confirm enabled status</step>
    <step>Retry the operation - attempt original SE API operation again after device is enabled</step>
    <step>Validate device functionality - perform self-test or diagnostic operations to verify device is operational</step>
    <step>If persistent, contact manufacturer - device may require servicing if it cannot be enabled</step>
  </recovery>
  <relatedExceptions>
    <exception>ErrorSecureElementNotInitialized</exception>
    <exception>ErrorDeviceNotInitialized</exception>
    <exception>ErrorFunctionFailed</exception>
    <exception>ErrorClientNotRegistered</exception>
  </relatedExceptions>
  <postconditionality>
    <state name="Operation Not Executed">The requested SE API operation is not executed because the Secure Element cannot operate while disabled.</state>
    <state name="Device State Unchanged">The device's state remains unchanged - disabled state persists.</state>
    <state name="No Data Modified">No transaction data, log messages, or device configuration is modified by the failed operation.</state>
    <state name="Caller Receives Exception">The caller receives ErrorSecureElementDisabled exception instead of normal operation result.</state>
    <state name="Device Remains Disabled">The device remains in disabled state - the operation failure does not automatically re-enable it.</state>
    <state name="Manual Intervention Required">Re-enabling the device requires administrative action or management interface interaction.</state>
  </postconditionality>
  <notes>
    <note>ErrorSecureElementDisabled is raised by 17 SE API functions that require an active Secure Element</note>
    <note>The disabled state is a device-level state affecting all SE API operations</note>
    <note>The exception has Critical severity because it blocks ALL SE API functionality</note>
    <note>Disabled state is typically set through administrative management interface or policy</note>
    <note>The device must be explicitly re-enabled before operations can resume</note>
    <note>Disabled state may be temporary (during recovery) or permanent (deactivation)</note>
    <note>Security policy may automatically disable device under certain conditions</note>
    <note>Device initialization must be complete before device can be enabled</note>
    <note>All state-changing operations require enabled Secure Element</note>
    <note>Query operations (getDeviceInfo, getDescription) may not require enabled state - check specification</note>
    <note>Backup/restore operations may be restricted on disabled Secure Element</note>
    <note>Transaction operations cannot proceed if device is disabled</note>
    <note>Authentication operations require enabled Secure Element to process credentials</note>
    <note>Error messages should indicate the device is disabled not broken</note>
    <note>Disabled state should be queryable through device status API</note>
  </notes>
  <usage>
    <scenario name="Scenario 1: Operation Blocked by Device Disabled State">
      <description>An application attempts to authenticate a user by calling authenticateUser. The Secure Element is disabled due to administrative policy. ErrorSecureElementDisabled is raised immediately. The application informs the user that the device is not available for operations.</description>
      <relatedFunctions>authenticateUser, getDeviceInfo</relatedFunctions>
      <errorContext>User authentication blocked because device is administratively disabled</errorContext>
    </scenario>
    <scenario name="Scenario 2: Recovery Procedure for Disabled Device">
      <description>A transaction processing system receives ErrorSecureElementDisabled when attempting to start a transaction. The administrator is notified. The administrator verifies the policy, re-enables the device through management interface, and the system retries the transaction.</description>
      <relatedFunctions>startTransaction, enableSecureElement (management)</relatedFunctions>
      <errorContext>Transaction processing blocked by disabled device - requires administrative intervention</errorContext>
    </scenario>
    <scenario name="Scenario 3: Device Lifecycle Management with Disabled State">
      <description>During device deactivation, the manufacturer sets the device to disabled state. All SE API operations fail with ErrorSecureElementDisabled. The device is scheduled for removal. After device is removed, no further operations are attempted.</description>
      <relatedFunctions>all SE API functions</relatedFunctions>
      <errorContext>Device in deactivation state - all operations blocked</errorContext>
    </scenario>
    <scenario name="Scenario 4: Temporary Disable During Device Recovery">
      <description>The device encounters a critical error and automatically disables itself for safety. User attempts to call updateTime and receives ErrorSecureElementDisabled. After device recovery completes, it re-enables itself and operations resume normally.</description>
      <relatedFunctions>updateTime, selfTest, getDeviceInfo</relatedFunctions>
      <errorContext>Temporary device disable during error recovery</errorContext>
    </scenario>
  </usage>
  <implementationContext>
    <note>Every SE API function requiring an enabled Secure Element must check device enabled/disabled state at entry</note>
    <note>The enabled/disabled check must occur before attempting device communication</note>
    <note>Device state should be queryable through status API to determine if disabled</note>
    <note>Clear error messages should distinguish between disabled vs. not-initialized vs. failed states</note>
    <note>Administrative enable/disable operations must be protected with appropriate authorization</note>
    <note>Security policy should be able to automatically disable device under certain conditions</note>
    <note>Device manufacturer should document how to enable/disable the Secure Element</note>
    <note>Management interfaces should provide clear visibility into enabled/disabled state</note>
    <note>Device should not lose data or configurations when disabled and re-enabled</note>
    <note>Disabled state should be persistent across device resets unless explicitly reset to default</note>
  </implementationContext>
</exception>
