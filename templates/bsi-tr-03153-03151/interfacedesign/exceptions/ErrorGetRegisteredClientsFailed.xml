<?xml version='1.0' encoding='UTF-8' standalone='yes'?>
<exception xmlns="http://bsi.bund.de/TR03151" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="ErrorGetRegisteredClientsFailed" xsi:schemaLocation="http://bsi.bund.de/TR03151 ../../schema/exceptions.xsd">
  <name>ErrorGetRegisteredClientsFailed</name>
  <description>This exception is thrown if the SE API function getRegisteredClients fails to retrieve the list of currently registered clients on the Secure Element. The function attempts to obtain detailed information about all registered client applications, but the retrieval process fails before the client list can be determined and returned.</description>
  <category>Client Management</category>
  <subcategory>Client Enumeration</subcategory>
  <severity>High</severity>
  <javadoc>
    <summary>This class defines the exception ErrorGetRegisteredClientsFailed that is thrown if the determination of the currently registered clients failed.</summary>
    <description>This exception is thrown when the getRegisteredClients function cannot retrieve the list of registered clients from the Secure Element. Registered clients information provides detailed enumeration of all currently registered client applications, including client identifiers and status information. ErrorGetRegisteredClientsFailed indicates that the Secure Element cannot provide the client list due to hardware failure, storage corruption, internal client management system errors, communication failures, or Secure Element state restrictions. When this exception occurs, no client list is returned and applications cannot enumerate or inspect registered clients. Recovery typically involves device verification, client management subsystem diagnostics, and possible hardware diagnosis if the failure persists.</description>
  </javadoc>
  <specification>
    <source>BSI TR-03151-1</source>
    <section>3.2.4 Client Management - getRegisteredClients</section>
    <requirement>The function getRegisteredClients SHALL query the Secure Element to determine the list of all currently registered clients. If the Secure Element cannot provide or return the required client list, the function SHALL raise the exception ErrorGetRegisteredClientsFailed and exit without returning any client data. The registered client retrieval failure indicates the Secure Element's client enumeration query functionality could not complete successfully.</requirement>
    <applicability>Client management operations - getRegisteredClients function only</applicability>
    <reference>getRegisteredClients – Function (3.2.4)</reference>
  </specification>
  <thrownBy>
    <function>getRegisteredClients</function>
  </thrownBy>
  <triggerConditions>
    <condition>
      <scenario>Client registry hardware failure</scenario>
      <description>The Secure Element's client registry hardware malfunctions or becomes inaccessible, preventing client list retrieval</description>
      <trigger>The Secure Element's client registry storage hardware fails or experiences read errors. When getRegisteredClients is called, the client list query is sent to the Secure Element, but the hardware cannot provide valid client data. The function receives a failure status from the Secure Element, triggering ErrorGetRegisteredClientsFailed.</trigger>
    </condition>
    <condition>
      <scenario>Client registry data corruption</scenario>
      <description>The Secure Element's client registry or registered client tracking data becomes corrupted or is lost</description>
      <trigger>The Secure Element's memory containing client registry, registered client tracking tables, or client metadata becomes corrupted, experiences data loss, or is marked as inaccessible due to storage errors. When getRegisteredClients attempts to read the client list, the data cannot be reliably retrieved, triggering ErrorGetRegisteredClientsFailed.</trigger>
    </condition>
    <condition>
      <scenario>Client management subsystem internal error</scenario>
      <description>The Secure Element's client management subsystem encounters critical errors that prevent client enumeration</description>
      <trigger>The Secure Element's client management subsystem (responsible for managing client registrations and providing client state) encounters an internal error, deadlock, or exception. When getRegisteredClients is called, the client management system cannot process the enumeration query, triggering ErrorGetRegisteredClientsFailed.</trigger>
    </condition>
    <condition>
      <scenario>Device-to-Secure Element communication failure during client query</scenario>
      <description>The communication channel between device and Secure Element is disrupted during registered client list retrieval</description>
      <trigger>A communication failure occurs while getRegisteredClients transmits the client query to the Secure Element or while receiving the client list response. The command may be corrupted, the response may be incomplete, or the communication link may be temporarily unavailable. The function receives a communication error status, triggering ErrorGetRegisteredClientsFailed.</trigger>
    </condition>
    <condition>
      <scenario>Secure Element in restricted or error state prohibiting client access</scenario>
      <description>The Secure Element is in a locked, restricted, or error state that prevents external queries for client information</description>
      <trigger>The Secure Element enters a state where client queries or client enumeration is not permitted. When getRegisteredClients is called and the Secure Element's state prohibits client access, the function receives a state-related rejection, triggering ErrorGetRegisteredClientsFailed.</trigger>
    </condition>
  </triggerConditions>
  <executionSequence>
    <step number="1">User/application calls getRegisteredClients function on device</step>
    <step number="2">Function validates input parameters and checks authentication status (if required by referencing guideline)</step>
    <step number="3">Function checks authorization for client management information access (if required by referencing guideline)</step>
    <step number="4">Function verifies device is properly initialized and client management is operational</step>
    <step number="5">Function initiates communication channel to Secure Element and prepares client enumeration query command</step>
    <step number="6">Function transmits client query command to Secure Element requesting list of all registered clients</step>
    <step number="6a">If Secure Element responds with failure status (registry error, client enumeration error, management error) → ErrorGetRegisteredClientsFailed raised, function exits without client list</step>
    <step number="6b">If communication failure occurs during query transmission or response reception → ErrorGetRegisteredClientsFailed raised, function exits</step>
    <step number="7">If successful, function receives registered client list from Secure Element</step>
    <step number="8">Function validates client list for correctness (format, client ID validity, state consistency)</step>
    <step number="9">Function closes Secure Element communication channel</step>
    <step number="10">Function returns valid registered client list to caller</step>
  </executionSequence>
  <recovery>
    <step>Verify device is initialized</step>
    <step>Confirm Secure Element is operational</step>
    <step>Retry client list query operation</step>
    <step>Maintain application-level client registry as backup</step>
  </recovery>
  <relatedExceptions>
    <exception>ErrorFunctionFailed</exception>
    <exception>ErrorDeviceNotInitialized</exception>
    <exception>ErrorRegisterClientFailed</exception>
    <exception>ErrorGetCurrentNumberOfClientsFailed</exception>
    <exception>ErrorGetMaxNumberOfClientsFailed</exception>
  </relatedExceptions>
  <postconditionality>
    <state name="Device Operational State">Device remains fully operational and unmodified. The failure to retrieve registered clients list does not affect device initialization state, client management operations, internal memory, stored data, or the ability to perform other operations. All device components remain in their pre-call state.</state>
    <state name="Client List Return Status">No client list is returned to the caller. The function exits without providing any registered client information. Applications must not assume default client lists or cached information; they must handle the exception as indicating client enumeration is unavailable.</state>
    <state name="Secure Element Client Management State">Secure Element client management subsystem remains unchanged by the failed query. No state modifications, client changes, or client management configuration changes occur. Client management operations continue normally regardless of the retrieval failure.</state>
    <state name="Registered Client Continuity">Registered clients continue to be maintained internally in the Secure Element. The failure to retrieve the client list does not affect client registrations or client management operations. Client queries can be retried once the underlying issue is resolved.</state>
    <state name="No Cascading State Effects">No cascading state inconsistencies or secondary failures occur as a result of the client query failure. Device internal consistency is maintained. Other SE API functions and client management operations continue normally without state corruption.</state>
    <state name="Recovery Preconditions Met">The device state after exception is consistent and allows for recovery operations. The underlying issue (hardware error, communication error, management system error) remains present, but the device is stable enough to accept diagnostic queries or recovery attempts.</state>
  </postconditionality>
  <notes>
    <note>Indication: Retrieval of registered clients list failed - cannot determine registered clients</note>
    <note>Topics: Client Management, Information Retrieval, Client Registry, Client Listing</note>
  </notes>
  <usage>
    <scenario name="Scenario 1: Active Client Monitoring and Client Lifecycle Management">
      <description>A client management system monitors registered clients to track client lifecycle and ensure proper client state. The system periodically calls getRegisteredClients to enumerate all registered clients and verify their status. If ErrorGetRegisteredClientsFailed is raised, the management system cannot assess client status and must alert administrators to the monitoring failure.</description>
      <relatedFunctions>getRegisteredClients, getCurrentNumberOfClients, getMaxNumberOfClients</relatedFunctions>
      <errorContext>Registered client list unavailable for client lifecycle monitoring and management</errorContext>
    </scenario>
    <scenario name="Scenario 2: Client Registration Verification and Audit Operations">
      <description>An audit system verifies that expected clients are properly registered and identifies any unexpected or orphaned client registrations. The system calls getRegisteredClients to enumerate all registered clients and compares against expected client configurations. If ErrorGetRegisteredClientsFailed is raised, the audit cannot verify client registrations.</description>
      <relatedFunctions>getRegisteredClients, getCurrentNumberOfClients, registerClient</relatedFunctions>
      <errorContext>Registered client list unavailable for client registration audit and verification</errorContext>
    </scenario>
    <scenario name="Scenario 3: Device Health Assessment and Client State Validation">
      <description>A comprehensive health assessment tool collects detailed device diagnostics including client state information. The tool calls getRegisteredClients to enumerate all registered clients as part of the health assessment. If ErrorGetRegisteredClientsFailed is raised, the tool cannot include client state information in the health report.</description>
      <relatedFunctions>getRegisteredClients, getCurrentNumberOfClients, getDeviceHealth</relatedFunctions>
      <errorContext>Registered client list unavailable for device health assessment and diagnostics</errorContext>
    </scenario>
    <scenario name="Scenario 4: Multi-Device Client State Synchronization and Configuration Management">
      <description>An enterprise system managing clients across multiple devices synchronizes client state by querying getRegisteredClients on each device. This provides a complete view of all registered clients across the infrastructure. If ErrorGetRegisteredClientsFailed is raised on one device, the system cannot determine that device's client state.</description>
      <relatedFunctions>getRegisteredClients, getCurrentNumberOfClients, registerClient</relatedFunctions>
      <errorContext>Registered client list unavailable for multi-device client synchronization</errorContext>
    </scenario>
  </usage>
  <implementationContext>
    <note>Raised by getRegisteredClients when client list retrieval fails</note>
    <note>Query function retrieves list of currently registered clients</note>
    <note>Device maintains client registry with active registrations</note>
    <note>Retrieval failure prevents registered client list access</note>
  </implementationContext>
</exception>

