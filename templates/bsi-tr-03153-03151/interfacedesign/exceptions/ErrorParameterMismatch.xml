<?xml version='1.0' encoding='UTF-8' standalone='yes'?>
<exception xmlns="http://bsi.bund.de/TR03151" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="ErrorParameterMismatch" xsi:schemaLocation="http://bsi.bund.de/TR03151 ../../schema/exceptions.xsd">
  <name>ErrorParameterMismatch</name>
  <description>This exception is thrown if the SE API export functions exportLogMessages or exportFilteredTransactionLogs detect that the provided filter or selection parameters are incompatible, contradictory, or logically inconsistent. The parameters may violate expected constraints, have logically contradictory values, or be inconsistent with each other. ErrorParameterMismatch indicates that the combination of parameters provided cannot be used to perform a valid export operation due to parameter conflicts or incompatibilities.</description>
  <category>Data Export - Parameter Validation</category>
  <severity>Medium</severity>
  <thrownBy>
    <function>exportFilteredTransactionLogs</function>
  </thrownBy>
  <javadoc>
    <summary>This class defines the exception ErrorParameterMismatch that is thrown if there is a mismatch regarding the particular parameters provided for data export operations.</summary>
    <description>This exception is thrown when exportLogMessages or exportFilteredTransactionLogs functions receive parameter values that are incompatible, contradictory, or logically inconsistent. Export functions accept filtering parameters such as date ranges, event types, client IDs, transaction states, and other selection criteria. ErrorParameterMismatch is raised when these parameters have conflicts or inconsistencies that prevent valid export operation execution. Common causes include: date range where start date is after end date, mutually exclusive filter options both specified, parameter values outside acceptable ranges or incompatible with other parameters, or parameters that violate data model constraints. Recovery requires correcting the parameter values to remove contradictions and ensure logical consistency before retrying the export operation.</description>
  </javadoc>
  <specification>
    <source>BSI TR-03151-1</source>
    <section>3.3.2 Data Export Operations - exportLogMessages and exportFilteredTransactionLogs</section>
    <requirement>The functions exportLogMessages and exportFilteredTransactionLogs accept filtering and selection parameters to specify which stored data should be exported. These functions SHALL validate the provided parameters for logical consistency and compatibility. If the parameters are found to be incompatible, contradictory, or mutually inconsistent, the functions SHALL raise the exception ErrorParameterMismatch without performing the export operation. The exception indicates that the parameter values contain conflicts or violate expected constraints.</requirement>
    <applicability>Data export operations - exportLogMessages and exportFilteredTransactionLogs functions only, when parameters are inconsistent</applicability>
    <reference>exportLogMessages – Function (3.3.2); exportFilteredTransactionLogs – Function (3.3.2)</reference>
  </specification>
  <triggerConditions>
    <condition>
      <scenario>Date range parameters logically invalid</scenario>
      <description>The start date/time is after the end date/time in the filter criteria</description>
      <trigger>The application calls exportLogMessages with startDate = "2025-12-20" and endDate = "2025-12-10". The start date is after the end date, which is logically invalid and cannot produce meaningful results. ErrorParameterMismatch is raised.</trigger>
    </condition>
    <condition>
      <scenario>Mutually exclusive filter options both specified</scenario>
      <description>Filter parameters specify mutually exclusive options that cannot both be true</description>
      <trigger>The application calls exportFilteredTransactionLogs with filter criteria that specify both "AllTransactions=true" and "ClientID='SpecificClient'". These are mutually exclusive options - the function cannot both export all transactions and filter to a specific client. ErrorParameterMismatch is raised.</trigger>
    </condition>
    <condition>
      <scenario>Parameter values outside acceptable range</scenario>
      <description>One or more parameter values are outside the valid range for that parameter</description>
      <trigger>The application calls exportLogMessages with a maximum result count = -100 (negative value). The parameter is outside the acceptable range (should be positive). ErrorParameterMismatch is raised.</trigger>
    </condition>
    <condition>
      <scenario>Parameters violate data model constraints</scenario>
      <description>The combination of parameters violates expected relationships or constraints in the device data model</description>
      <trigger>The application specifies contradictory transaction states in filter criteria (e.g., both "Completed" and "Pending" states with a logical AND operator when these are mutually exclusive). ErrorParameterMismatch is raised.</trigger>
    </condition>
    <condition>
      <scenario>Parameter format or type inconsistency</scenario>
      <description>Parameters have format or type inconsistencies that prevent interpretation</description>
      <trigger>The application provides a date parameter in an invalid format or with inconsistent field types. The export function cannot consistently interpret the parameters. ErrorParameterMismatch is raised.</trigger>
    </condition>
  </triggerConditions>
  <executionSequence>
    <step number="1">User/application calls exportLogMessages or exportFilteredTransactionLogs function with filter/selection parameters</step>
    <step number="2">Function receives and buffers the parameter values</step>
    <step number="3">Function performs initial parameter validation (format, type, presence)</step>
    <step number="4">Function performs consistency validation on parameters</step>
    <step number="4a">If parameters are logically consistent and compatible → proceed to step 5</step>
    <step number="4b">If parameters are inconsistent or incompatible → ErrorParameterMismatch raised, function exits</step>
    <step number="5">Function checks parameter ranges and values against acceptable constraints</step>
    <step number="5a">If values are within acceptable ranges → proceed to step 6</step>
    <step number="5b">If values are outside acceptable ranges → ErrorParameterMismatch raised, function exits</step>
    <step number="6">Function validates parameters against data model constraints</step>
    <step number="7">Function initiates communication with Secure Element</step>
    <step number="8">Function transmits export command with parameters to Secure Element</step>
    <step number="9">Function receives matching data from Secure Element</step>
    <step number="10">Function formats and packages data for export</step>
    <step number="11">Function closes communication channel with Secure Element</step>
    <step number="12">Function returns exported data to caller</step>
  </executionSequence>
  <recovery>
    <step>Review parameter values - examine all parameters provided to the export function</step>
    <step>Check date/time ranges - verify that start dates/times are before end dates/times (if applicable)</step>
    <step>Verify mutual exclusivity - identify any mutually exclusive options and ensure at most one is specified</step>
    <step>Check value ranges - verify that all numeric parameters are within acceptable ranges</step>
    <step>Review data model constraints - consult documentation for constraints that apply to parameter combinations</step>
    <step>Validate parameter format - ensure all parameters are in correct format and data type</step>
    <step>Correct contradictory parameters - if parameters are contradictory, clarify requirements and specify consistent parameters</step>
    <step>Consult parameter documentation - review BSI TR-03151-1 or device documentation for parameter requirements and constraints</step>
    <step>Test with simplified parameters - try export with minimal or simplified parameter set to isolate which parameters are causing the mismatch</step>
    <step>Retry with corrected parameters - once parameters are corrected to be logically consistent, retry the export operation</step>
  </recovery>
  <relatedExceptions>
    <exception>ErrorInvalidEventType</exception>
    <exception>ErrorInvalidClientIdCharacter</exception>
    <exception>ErrorInvalidTime</exception>
    <exception>ErrorNoDataAvailable</exception>
    <exception>ErrorFunctionFailed</exception>
  </relatedExceptions>
  <postconditionality>
    <state name="No Data Exported">No export is performed. The operation is rejected at the parameter validation stage before any data access occurs.</state>
    <state name="Storage Unchanged">The device's data storage remains completely unchanged. No read or write operations occur.</state>
    <state name="Device State Unmodified">The device's overall state remains unchanged by the parameter validation failure.</state>
    <state name="No Cascading Effects">The failed parameter validation does not trigger cascading failures or secondary exceptions.</state>
    <state name="Parameters Preserved for Debugging">The invalid parameters remain available for inspection and debugging to identify the specific mismatch.</state>
    <state name="Retry Possible with Corrected Parameters">The operation can be retried immediately after correcting the parameter values to be consistent.</state>
  </postconditionality>
  <notes>
    <note>Indication: Function parameters do not match expected types or formats</note>
    <note>Topics: Parameter Validation, Input Validation, Function Parameters, Type Checking</note>
  </notes>
  <usage>
    <scenario name="Scenario 1: Date Range Export with Validation">
      <description>An application attempts to export logs for a date range by calling exportLogMessages with startDate and endDate parameters. When ErrorParameterMismatch is raised, it indicates the start date is after the end date. The application corrects the date order and retries the export.</description>
      <relatedFunctions>exportLogMessages, exportFilteredTransactionLogs</relatedFunctions>
      <errorContext>Date range parameters logically invalid - start date after end date</errorContext>
    </scenario>
    <scenario name="Scenario 2: Complex Filtering with Mutual Exclusivity Check">
      <description>An application implements complex filtering logic for exportFilteredTransactionLogs with multiple filter options. When ErrorParameterMismatch is raised, it indicates the application has specified mutually exclusive options. The application corrects the filter logic to ensure only compatible options are specified together.</description>
      <relatedFunctions>exportFilteredTransactionLogs, exportLogMessages</relatedFunctions>
      <errorContext>Mutually exclusive filter options both specified</errorContext>
    </scenario>
    <scenario name="Scenario 3: Parameter Validation Utility with Error Prevention">
      <description>An enterprise application implements a parameter validation utility that checks export parameters before calling export functions. The utility validates date ranges, option compatibility, and value ranges. By catching errors early, the application prevents ErrorParameterMismatch exceptions from being raised.</description>
      <relatedFunctions>exportLogMessages, exportFilteredTransactionLogs</relatedFunctions>
      <errorContext>Preventive parameter validation catches mismatches before export attempt</errorContext>
    </scenario>
    <scenario name="Scenario 4: Debugging and Constraint Discovery">
      <description>A developer is implementing an export client and encounters ErrorParameterMismatch when trying various parameter combinations. The exceptions are used to discover and understand the device's parameter constraints. By systematically testing parameter combinations and handling ErrorParameterMismatch, the developer maps the parameter compatibility rules.</description>
      <relatedFunctions>exportLogMessages, exportFilteredTransactionLogs</relatedFunctions>
      <errorContext>Exception used for constraint discovery and API learning</errorContext>
    </scenario>
  </usage>
  <implementationContext>
    <note>Raised by functions when parameter types do not match expected types</note>
    <note>Parameter type validation enforces strict type checking</note>
    <note>Device validates parameter compatibility</note>
    <note>Type mismatch prevents function execution</note>
  </implementationContext>
</exception>
