<?xml version='1.0' encoding='UTF-8' standalone='yes'?>
<exception xmlns="http://bsi.bund.de/TR03151" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="ErrorCurrentNumberOfClientsNotTracked" xsi:schemaLocation="http://bsi.bund.de/TR03151 ../../schema/exceptions.xsd">
  <name>ErrorCurrentNumberOfClientsNotTracked</name>
  <description>This exception is thrown if the device does not track the current number of registered clients and therefore cannot provide this information through the getCurrentNumberOfClients function. The exception represents a device capability limitation rather than a functional failure. ErrorCurrentNumberOfClientsNotTracked is raised when an application invokes getCurrentNumberOfClients on a device that supports a practically unlimited number of clients simultaneously and has deliberately omitted client counting functionality to avoid performance overhead. This exception indicates that the device is operating normally, but the specific capability to enumerate or count currently registered clients is not implemented or has been disabled. The exception is raised after the device validates that the function was invoked correctly but determines that client tracking is not available on this device variant.</description>
  <category>Client Management</category>
  <subcategory>State Tracking</subcategory>
  <severity>Medium</severity>
  <javadoc>
    <summary>This class defines the exception ErrorCurrentNumberOfClientsNotTracked that is thrown if the devices does not track the current number of (registered) clients. Therefore, the SE API function getCurrentNumberOfClients cannot provide a number.</summary>
    <description>The device supports a practically unlimited number of clients simultaneously and does not track the current number of clients. This exception is raised when the device capability to count active clients is not available, typically in systems designed for unlimited scalability.</description>
  </javadoc>
  <specification>
    <source>BSI TR-03151-1</source>
    <section>3.7.9.2.3</section>
    <requirement>MAY be raised when the device supports a practically unlimited number of clients simultaneously and at the same time does not track the current number of clients. If the device does not support client counting, the function SHALL raise the exception ErrorCurrentNumberOfClientsNotTracked and exit the function.</requirement>
    <applicability>Client counting query when device does not support client tracking</applicability>
    <reference>getCurrentNumberOfClients â€“ Exceptions (3.7.9.2.3)</reference>
  </specification>
  <thrownBy>
    <function>getCurrentNumberOfClients</function>
  </thrownBy>
  <triggerConditions>
    <condition>
      <scenario>Device with unlimited client support and no tracking mechanism</scenario>
      <description>The device is configured to support a practically unlimited number of simultaneous clients and has deliberately omitted client counting functionality to avoid performance overhead and complexity. When getCurrentNumberOfClients is invoked, the device detects that client tracking is not available.</description>
      <trigger>Invocation of getCurrentNumberOfClients on device without client tracking implementation</trigger>
    </condition>
    <condition>
      <scenario>Client tracking disabled via device configuration</scenario>
      <description>The device implementation supports client tracking in general, but client tracking has been disabled or suspended through device configuration settings. This might be done for performance reasons, memory constraints, or to support a specific operational mode.</description>
      <trigger>getCurrentNumberOfClients called on device with tracking capability but disabled tracking feature</trigger>
    </condition>
    <condition>
      <scenario>Device variant without client management subsystem</scenario>
      <description>The device is a variant that does not implement the client management subsystem at all. The registerClient and deregisterClient functions may not be implemented, and consequently, client tracking is also not available.</description>
      <trigger>getCurrentNumberOfClients invoked on device variant without client management implementation</trigger>
    </condition>
    <condition>
      <scenario>Client tracking unavailable due to device state</scenario>
      <description>The device or a critical subsystem responsible for client tracking is in a state where tracking information cannot be reliably provided. This might occur after firmware updates, during recovery from errors, or during specific operational modes.</description>
      <trigger>Client tracking subsystem temporarily or permanently unavailable on this device instance</trigger>
    </condition>
  </triggerConditions>
  <recovery>
    <step>Confirm device is in valid initialized state</step>
    <step>Retry getCurrentNumberOfClients operation</step>
    <step>If unavailable, estimate client count from application-level tracking</step>
    <step>Check device status using getDeviceHealth</step>
  </recovery>
  <relatedExceptions>
    <exception>ErrorGetCurrentNumberOfClientsFailed</exception>
    <exception>ErrorGetMaxNumberOfClientsFailed</exception>
    <exception>ErrorDeviceNotInitialized</exception>
  </relatedExceptions>
  <executionSequence>
    <step number="1" name="Function Invocation">Function entry point is reached for getCurrentNumberOfClients with no parameters required</step>
    <step number="2" name="Device Capability Check">The device checks whether client tracking capability is available and enabled on this device instance</step>
    <step number="3" name="Tracking Availability Detection">The device evaluates its configuration and firmware to determine if client tracking functionality is present and operational</step>
    <step number="4a" name="Tracking Available">If client tracking is available, execution branches to retrieve and return the current client count (not taken in this exception case)</step>
    <step number="4b" name="Tracking Not Available">If client tracking is not available, execution branches to exception handling at step 5</step>
    <step number="5" name="Exception Context Preparation">Exception context is prepared including device capability information, firmware version, and device configuration state indicating absence of client tracking</step>
    <step number="6" name="Exception Instance Creation">ErrorCurrentNumberOfClientsNotTracked exception instance is created with appropriate error message indicating that client tracking is not supported on this device</step>
    <step number="7" name="Exception Propagation">Exception is raised and propagated up the call stack to the calling application, allowing capability-aware error handling</step>
    <step number="8" name="Application Decision Point">The calling application receives the exception and must decide whether to implement fallback mechanisms, use alternative functions, or abort operations that require client counting</step>
  </executionSequence>
  <postconditionality>
    <state name="Exception State">An ErrorCurrentNumberOfClientsNotTracked exception has been created and raised, indicating that client counting capability is not available on this device</state>
    <state name="Device State">The device remains in its previous operational state. No device state has changed as a result of this operation or exception. The device continues to operate normally without client tracking.</state>
    <state name="Client Registry State">The client registry (if implemented) remains unchanged. No clients have been registered or deregistered as a result of this operation.</state>
    <state name="Device Capability State">The absence of client tracking capability is a permanent characteristic of this device variant or configuration, not a temporary condition. The device capability cannot be changed through subsequent API calls without reinitialization or firmware update.</state>
    <state name="Function Exit">The function exits via exception propagation without providing client count information or returning normally</state>
    <state name="Application Awareness">The calling application learns through this exception that it cannot depend on server-side client counting for this device and must implement alternative strategies</state>
  </postconditionality>
  <notes>
    <note>Indication: Current number of registered clients cannot be retrieved - tracking information unavailable</note>
    <note>Topics: Client Management, Device State, Information Retrieval, Resource Tracking</note>
  </notes>
  <usage>
    <scenario name="Scenario 1: Device Capability Discovery at Initialization">
      <description>An application attempts to query client count at initialization time to discover device capabilities. The exception indicates that client tracking is not available, prompting the application to implement client-side tracking.</description>
      <relatedFunctions>getCurrentNumberOfClients, getMaxNumberOfClients, initializeDevice</relatedFunctions>
      <errorContext>Capability discovery phase where application learns that client tracking is not available</errorContext>
    </scenario>
    <scenario name="Scenario 2: Fallback to Alternative Client Information">
      <description>An application that requires client capacity information receives this exception and falls back to querying getMaxNumberOfClients or getRegisteredClients to obtain related information.</description>
      <relatedFunctions>getCurrentNumberOfClients, getMaxNumberOfClients, getRegisteredClients</relatedFunctions>
      <errorContext>Graceful degradation where application adapts to missing capability</errorContext>
    </scenario>
    <scenario name="Scenario 3: Application-Level Client Registry Implementation">
      <description>An application responds to this exception by implementing its own client registry at the application level, tracking client registrations and deregistrations internally to monitor client counts.</description>
      <relatedFunctions>getCurrentNumberOfClients, registerClient, deregisterClient</relatedFunctions>
      <errorContext>Client management where application mirrors server-side client registration in local data structures</errorContext>
    </scenario>
    <scenario name="Scenario 4: Device Variant Selection Based on Client Tracking">
      <description>An application that critically depends on client counting receives this exception and determines that this device variant is unsuitable. The application may retry with a different device instance or variant that supports client tracking.</description>
      <relatedFunctions>getCurrentNumberOfClients, getComponentVersions, getDeviceHealth</relatedFunctions>
      <errorContext>Device selection scenario where client tracking capability drives device choice</errorContext>
    </scenario>
  </usage>
  <implementationContext>
    <note>Raised by getCurrentNumberOfClients when client count tracking unavailable</note>
    <note>Device maintains current client count as part of runtime state</note>
    <note>Tracking mechanism may be unavailable in certain device states</note>
    <note>Application cannot retrieve real-time client count at this time</note>
  </implementationContext>
</exception>

