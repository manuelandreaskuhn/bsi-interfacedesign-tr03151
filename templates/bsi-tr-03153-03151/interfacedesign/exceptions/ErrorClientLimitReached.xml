<?xml version='1.0' encoding='UTF-8' standalone='yes'?>
<exception xmlns="http://bsi.bund.de/TR03151" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="ErrorClientLimitReached" xsi:schemaLocation="http://bsi.bund.de/TR03151 ../../schema/exceptions.xsd">
  <name>ErrorClientLimitReached</name>
  <description>This exception is thrown if the maximum number of clients has been reached. The registerClient function attempts to register a new client but detects that the device has already registered the maximum number of simultaneous clients it can manage. No further client registrations are possible until existing clients are deregistered.</description>
  <category>Client Management - Capacity</category>
  <severity>High</severity>
  <javadoc>
    <summary>This class defines the exception ErrorClientLimitReached that is thrown if the maximum number of clients has been reached.</summary>
    <description>The ErrorClientLimitReached exception indicates that the device has reached its maximum capacity for managing simultaneous clients and cannot accept additional client registrations. This is a resource limitation exception that requires the application to deregister existing clients or implement alternative strategies to proceed. When this exception is raised, the registration operation fails immediately without modifying the client registry. The maximum number of simultaneous clients is a fixed device capability that can be queried using getMaxNumberOfClients.</description>
  </javadoc>
  <specification>
    <source>BSI TR-03151-1</source>
    <section>3.3.14 Client Management - registerClient Function (3.3.14.4)</section>
    <requirement>The function registerClient SHALL check if the device's maximum number of clients has been reached. If the maximum number has been reached, the function SHALL raise the exception ErrorClientLimitReached and exit the function without registering the new client. This ensures that client registrations do not exceed device capacity limits.</requirement>
    <applicability>Client registration operations - registerClient function when device client capacity is at maximum</applicability>
    <reference>registerClient – Function (3.3.14) - Section 3.3.14.4 Exception Specification</reference>
  </specification>
  <thrownBy>
    <function>registerClient</function>
  </thrownBy>
  <triggerConditions>
    <condition>
      <scenario>Client registration at device capacity</scenario>
      <description>The registerClient function is invoked while the device has already registered the maximum number of simultaneous clients</description>
      <trigger>The device checks its current client count and finds it equals the maximum allowed. ErrorClientLimitReached is raised to prevent exceeding device capacity.</trigger>
    </condition>
    <condition>
      <scenario>Multiple concurrent registration attempts at limit</scenario>
      <description>Multiple applications or threads attempt to register clients simultaneously when the device is at its maximum capacity</description>
      <trigger>Each registration attempt is checked against the device's maximum client limit. Once the limit is reached, subsequent attempts raise ErrorClientLimitReached.</trigger>
    </condition>
    <condition>
      <scenario>Resource exhaustion prevention</scenario>
      <description>The device implements client capacity limits to prevent resource exhaustion and ensure stable operation</description>
      <trigger>The device enforces its maximum client limit during registration to maintain system stability and performance.</trigger>
    </condition>
  </triggerConditions>
  <executionSequence>
    <step number="1">User/application calls registerClient function with a clientId</step>
    <step number="2">Function checks authentication status (if required by referencing guideline)</step>
    <step number="3">Function checks authorization (if required by referencing guideline)</step>
    <step number="4">Function checks device initialization status</step>
    <step number="5">Function checks if current number of registered clients equals maximum allowed</step>
    <step number="5a">If current clients EQUALS maximum → ErrorClientLimitReached raised and function exits</step>
    <step number="6">If below limit, function checks if clientId is already registered</step>
    <step number="7">If clientId is not registered, function validates clientId format and characters</step>
    <step number="8">Function adds clientId to device's client registry</step>
    <step number="9">Function returns successfully to the user</step>
  </executionSequence>
  <recovery>
    <step>Check current client count using getCurrentNumberOfClients</step>
    <step>Get maximum capacity using getMaxNumberOfClients</step>
    <step>Deregister unused clients to free capacity</step>
    <step>Plan application client usage to stay within device limits</step>
    <step>If necessary, migrate to device with higher client capacity</step>
  </recovery>
  <relatedExceptions>
    <exception>ErrorClientAlreadyRegistered</exception>
    <exception>ErrorClientNotRegistered</exception>
    <exception>ErrorFunctionFailed</exception>
    <exception>ErrorDeviceNotInitialized</exception>
  </relatedExceptions>
  <postconditionality>
    <state>Client registry unchanged - no client was registered</state>
    <state>Current number of clients unchanged - failed registration does not affect client count</state>
    <state>Device at maximum capacity - no additional clients can be registered until deregistration</state>
    <state>Device state unchanged - no modifications made during failed registration attempt</state>
    <state>Function exits without creating log message - registration did not succeed</state>
    <state>Capacity constraint remains in effect - device continues to enforce client limit</state>
  </postconditionality>
  <notes>
    <note>Indication: Maximum number of allowed clients has been reached - no additional clients can be registered</note>
    <note>Topics: Client Management, Registration, Resource Limits, Device Constraints</note>
  </notes>
  <usage>
    <scenario name="Scenario 1: Capacity Check Before Registration">
      <description>Check device capacity before attempting to register a new client to predict and handle registration failures. Query the current and maximum client counts to make registration decisions.</description>
      <relatedFunctions>registerClient, getCurrentNumberOfClients, getMaxNumberOfClients, deregisterClient</relatedFunctions>
      <errorContext>Device at maximum capacity - proactive capacity checking - deallocation needed before registration</errorContext>
    </scenario>
    <scenario name="Scenario 2: Deregister and Retry Strategy">
      <description>When capacity is exhausted, deregister an existing inactive client and retry registration for the new client to maintain required client count.</description>
      <relatedFunctions>registerClient, deregisterClient, getRegisteredClients</relatedFunctions>
      <errorContext>Capacity exhausted - client deallocation and retry - resource reclamation strategy</errorContext>
    </scenario>
    <scenario name="Scenario 3: Client Queue Management">
      <description>Implement a client registration queue that respects device capacity limits and manages registration attempts queue when capacity is reached.</description>
      <relatedFunctions>registerClient, getCurrentNumberOfClients, getMaxNumberOfClients</relatedFunctions>
      <errorContext>Capacity constraint enforcement - client queue management - deferred registration</errorContext>
    </scenario>
    <scenario name="Scenario 4: Capacity-Aware Load Balancing">
      <description>Distribute client registrations across multiple devices based on available capacity to avoid exhaustion on a single device and balance load.</description>
      <relatedFunctions>registerClient, getCurrentNumberOfClients, getMaxNumberOfClients</relatedFunctions>
      <errorContext>Multi-device registration - capacity-aware load balancing - device selection logic</errorContext>
    </scenario>
  </usage>
  <implementationContext>
    <note>Raised by registerClient when maximum registered client count exceeded</note>
    <note>Device maintains client registry with configurable capacity limits</note>
    <note>Registration fails when adding new client would exceed maximum</note>
    <note>Resource constraint prevents registration of additional clients</note>
  </implementationContext>
</exception>
