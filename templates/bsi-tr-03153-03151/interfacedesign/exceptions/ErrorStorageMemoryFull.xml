<?xml version='1.0' encoding='UTF-8' standalone='yes'?>
<exception xmlns="http://bsi.bund.de/TR03151" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="ErrorStorageMemoryFull" xsi:schemaLocation="http://bsi.bund.de/TR03151 ../../schema/exceptions.xsd">
  <name>ErrorStorageMemoryFull</name>
  <description>
    <text xml:lang="en">This exception is thrown if the storage memory of the device is full and cannot accommodate new data. The Secure Element uses storage for device configuration, transaction logs, user data, and audit trail information. When storage reaches capacity, no new data can be written until storage is freed by deleting or exporting logs. ErrorStorageMemoryFull indicates the device storage is exhausted and write operations must be blocked. Common causes include: excessive transaction volume, accumulation of log messages, inadequate storage capacity for workload, or logs not being regularly exported/archived. ErrorStorageMemoryFull is a Critical condition that prevents new transactions and data storage operations until storage space is freed.</text>
    <text xml:lang="de">Diese Ausnahme wird ausgelöst, wenn der Speicher des Geräts voll ist und keine neuen Daten aufnehmen kann. Das Secure Element nutzt Speicher für Gerätekonfiguration, Transaktionsprotokolle, Benutzerdaten und Audit-Trail-Informationen. Wenn der Speicher voll ist, können keine neuen Daten geschrieben werden, bis der Speicher durch Löschen oder Exportieren von Protokollen freigegeben wird. ErrorStorageMemoryFull zeigt an, dass der Gerätespeicher erschöpft ist und Schreibvorgänge blockiert werden müssen. Häufige Ursachen sind: übermäßiges Transaktionsvolumen, Ansammlung von Log-Messages, unzureichende Speicherkapazität für die Arbeitslast oder Protokolle, die nicht regelmäßig exportiert/archiviert werden. ErrorStorageMemoryFull ist ein kritischer Zustand, der neue Transaktionen und Datenspeicheroperationen blockiert, bis Speicherplatz freigegeben wird.</text>
  </description>
  <category>Storage</category>
  <subcategory>Storage Capacity - Memory Full</subcategory>
  <severity>Critical</severity>
  <thrownBy>
    <function>authenticateUser</function>
    <function>configureLogging</function>
    <function>deregisterClient</function>
    <function>disableSecureElement</function>
    <function>finishTransaction</function>
    <function>initialize</function>
    <function>lockTransactionLogging</function>
    <function>logOut</function>
    <function>registerClient</function>
    <function>restoreLogsFromBackup</function>
    <function>selfTest</function>
    <function>setDescription</function>
    <function>startTransaction</function>
    <function>unblockPin</function>
    <function>unlockTransactionLogging</function>
    <function>updateDevice</function>
    <function>updateTime</function>
    <function>updateTransaction</function>
  </thrownBy>
  <javadoc>
    <summary>
      <text xml:lang="en">This class defines the exception ErrorStorageMemoryFull that is thrown if the storage memory is full.</text>
      <text xml:lang="de">Diese Klasse definiert die Ausnahme ErrorStorageMemoryFull, die ausgelöst wird, wenn der Speicher voll ist.</text>
    </summary>
    <description>
      <text xml:lang="en">This exception is thrown when the device storage capacity is exhausted and no additional data can be written. The device storage holds configuration, transaction logs, user data, and audit trail information. ErrorStorageMemoryFull indicates the storage has reached full capacity and write operations cannot proceed. Common causes include: accumulation of transaction logs, excessive transaction volume, inadequate storage capacity for application workload, or logs not regularly exported or archived. ErrorStorageMemoryFull is a Critical severity exception because it blocks new transactions and prevents critical operations that require storage writes. The device cannot accept new transactions when storage is full. Recovery requires freeing storage space by exporting and deleting logs, or implementing archive procedures to manage storage utilization.</text>
      <text xml:lang="de">Diese Ausnahme wird ausgelöst, wenn die Gerätespeicherkapazität erschöpft ist und keine zusätzlichen Daten geschrieben werden können. Der Gerätespeicher speichert Konfiguration, Transaktionsprotokolle, Benutzerdaten und Audit-Trail-Informationen. ErrorStorageMemoryFull zeigt an, dass der Speicher die volle Kapazität erreicht hat und Schreibvorgänge nicht fortgesetzt werden können. Häufige Ursachen sind: Ansammlung von Transaktionsprotokollen, übermäßiges Transaktionsvolumen, unzureichende Speicherkapazität für die Anwendungsarbeitslast oder Protokolle, die nicht regelmäßig exportiert oder archiviert werden. ErrorStorageMemoryFull ist eine Ausnahme mit kritischer Schweregrad, da sie neue Transaktionen blockiert und kritische Operationen verhindert, die Speicherschreibvorgänge erfordern. Das Gerät kann keine neuen Transaktionen annehmen, wenn der Speicher voll ist. Die Wiederherstellung erfordert das Freigeben von Speicherplatz durch Exportieren und Löschen von Protokollen oder die Implementierung von Archivierungsverfahren zur Verwaltung der Speichernutzung.</text>
    </description>
  </javadoc>
  <specification>
    <source>BSI TR-03151-1</source>
    <section>3.2 Secure Element Storage Capacity and 3.3 SE API Functions - Storage Write Requirements</section>
    <requirement>
      <text xml:lang="en">The Secure Element storage has finite capacity for holding configuration, transaction logs, and audit trail data. When storage reaches full capacity, the device cannot accept new write operations. Any SE API function that requires writing to storage SHALL raise ErrorStorageMemoryFull if storage is full. Write operations that cannot proceed due to full storage include: transaction logging, configuration updates, log restoration, and data storage. The device must not silently drop data if storage is full. Storage management operations (export, delete) can free space to enable new writes. Adequate storage capacity planning is essential for system operation.</text>
      <text xml:lang="de">Der Secure Element-Speicher hat eine begrenzte Kapazität für die Speicherung von Konfiguration, Transaktionsprotokollen und Audit-Trail-Daten. Wenn der Speicher die volle Kapazität erreicht, kann das Gerät keine neuen Schreibvorgänge akzeptieren. Jede SE-API-Funktion, die das Schreiben in den Speicher erfordert, SOLL ErrorStorageMemoryFull auslösen, wenn der Speicher voll ist. Schreibvorgänge, die nicht fortgesetzt werden können, da der Speicher voll ist, umfassen: Transaktionsprotokollierung, Konfigurationsaktualisierungen, Log-Wiederherstellung und Datenspeicherung. Das Gerät darf Daten nicht stillschweigend verwerfen, wenn der Speicher voll ist. Speicherverwaltungsvorgänge (Export, Löschung) können Platz freigeben, um neue Schreibvorgänge zu ermöglichen. Eine angemessene Speicherkapazitätsplanung ist für den Systembetrieb unbedingt erforderlich.</text>
    </requirement>
    <applicability>
      <text xml:lang="en">Storage write operations: setDescription, startTransaction, updateTransaction, finishTransaction, restoreLogsFromBackup</text>
      <text xml:lang="de">Speicherschreiboperationen: setDescription, startTransaction, updateTransaction, finishTransaction, restoreLogsFromBackup</text>
    </applicability>
    <reference>Secure Element Storage Capacity (3.2), SE API Functions (3.3)</reference>
  </specification>
  <triggerConditions>
    <condition>
      <scenario>
        <text xml:lang="en">Storage capacity exhausted by transaction logs</text>
        <text xml:lang="de">Speicherkapazität durch Transaktionsprotokolle erschöpft</text>
      </scenario>
      <description>
        <text xml:lang="en">Transaction log accumulation has filled available storage</text>
        <text xml:lang="de">Die Ansammlung von Transaktionsprotokollen hat den verfügbaren Speicher gefüllt</text>
      </description>
      <trigger>
        <text xml:lang="en">A finishTransaction call attempts to write transaction log but storage is full. The device detects full storage and raises ErrorStorageMemoryFull.</text>
        <text xml:lang="de">Ein finishTransaction-Aufruf versucht, das Transaktionsprotokoll zu schreiben, aber der Speicher ist voll. Das Gerät erkennt vollen Speicher und löst ErrorStorageMemoryFull aus.</text>
      </trigger>
    </condition>
    <condition>
      <scenario>
        <text xml:lang="en">Inadequate storage for application workload</text>
        <text xml:lang="de">Unzureichender Speicher für die Anwendungsarbeitslast</text>
      </scenario>
      <description>
        <text xml:lang="en">Storage capacity is insufficient for the application's transaction volume</text>
        <text xml:lang="de">Die Speicherkapazität ist unzureichend für das Transaktionsvolumen der Anwendung</text>
      </description>
      <trigger>
        <text xml:lang="en">After many transactions, a startTransaction call attempts to create new transaction but storage is full. The device has insufficient storage for the workload and ErrorStorageMemoryFull is raised.</text>
        <text xml:lang="de">Nach vielen Transaktionen versucht ein startTransaction-Aufruf, eine neue Transaktion zu erstellen, aber der Speicher ist voll. Das Gerät hat unzureichenden Speicher für die Arbeitslast und ErrorStorageMemoryFull wird ausgelöst.</text>
      </trigger>
    </condition>
    <condition>
      <scenario>
        <text xml:lang="en">Logs not regularly exported or archived</text>
        <text xml:lang="de">Protokolle nicht regelmäßig exportiert oder archiviert</text>
      </scenario>
      <description>
        <text xml:lang="en">Storage fills because logs are not being managed through export/deletion</text>
        <text xml:lang="de">Der Speicher füllt sich, weil die Protokolle nicht durch Export/Löschung verwaltet werden</text>
      </description>
      <trigger>
        <text xml:lang="en">An updateTransaction call reaches storage full condition. Analysis reveals logs have accumulated without regular export/deletion and storage is exhausted.</text>
        <text xml:lang="de">Ein updateTransaction-Aufruf erreicht die Speicher-voll-Bedingung. Die Analyse zeigt, dass sich Protokolle ohne regelmäßigen Export/Löschung angesammelt haben und der Speicher erschöpft ist.</text>
      </trigger>
    </condition>
    <condition>
      <scenario>
        <text xml:lang="en">Configuration or user data consuming storage</text>
        <text xml:lang="de">Konfiguration oder Benutzerdaten verbrauchen Speicher</text>
      </scenario>
      <description>
        <text xml:lang="en">Device configuration or user data has consumed available storage space</text>
        <text xml:lang="de">Die Gerätekonfiguration oder Benutzerdaten haben den verfügbaren Speicherplatz verbraucht</text>
      </description>
      <trigger>
        <text xml:lang="en">A setDescription call attempts to update description but storage is full. Storage capacity is exhausted by accumulated data.</text>
        <text xml:lang="de">Ein setDescription-Aufruf versucht, die Beschreibung zu aktualisieren, aber der Speicher ist voll. Die Speicherkapazität ist durch angesammelte Daten erschöpft.</text>
      </trigger>
    </condition>
    <condition>
      <scenario>
        <text xml:lang="en">Log restoration attempt when storage is full</text>
        <text xml:lang="de">Versuch der Log-Wiederherstellung, wenn der Speicher voll ist</text>
      </scenario>
      <description>
        <text xml:lang="en">Attempting to restore logs from backup when storage is already full</text>
        <text xml:lang="de">Versuch, Protokolle aus einer Sicherung wiederherzustellen, wenn der Speicher bereits voll ist</text>
      </description>
      <trigger>
        <text xml:lang="en">A restoreLogsFromBackup call attempts to restore logs but storage is full. The restore cannot proceed and ErrorStorageMemoryFull is raised.</text>
        <text xml:lang="de">Ein restoreLogsFromBackup-Aufruf versucht, Protokolle wiederherzustellen, aber der Speicher ist voll. Die Wiederherstellung kann nicht fortgesetzt werden und ErrorStorageMemoryFull wird ausgelöst.</text>
      </trigger>
    </condition>
  </triggerConditions>
  <executionSequence>
    <step number="1">
      <text xml:lang="en">User/application calls an SE API function that requires storage write (e.g., finishTransaction)</text>
      <text xml:lang="de">Benutzer/Anwendung ruft eine SE-API-Funktion auf, die Speicherschreiben erfordert (z.B. finishTransaction)</text>
    </step>
    <step number="2">
      <text xml:lang="en">Function validates input parameters</text>
      <text xml:lang="de">Funktion validiert Eingabeparameter</text>
    </step>
    <step number="3">
      <text xml:lang="en">Function initiates communication with Secure Element</text>
      <text xml:lang="de">Funktion initiiert Kommunikation mit Secure Element</text>
    </step>
    <step number="4">
      <text xml:lang="en">Secure Element receives request</text>
      <text xml:lang="de">Secure Element empfängt Anfrage</text>
    </step>
    <step number="5">
      <text xml:lang="en">Secure Element checks storage capacity and available free space</text>
      <text xml:lang="de">Secure Element prüft Speicherkapazität und verfügbaren freien Platz</text>
    </step>
    <step number="5a">
      <text xml:lang="en">If storage is full and cannot accommodate new data → ErrorStorageMemoryFull raised, operation aborted</text>
      <text xml:lang="de">Wenn Speicher voll ist und keine neuen Daten aufnehmen kann → ErrorStorageMemoryFull ausgelöst, Operation abgebrochen</text>
    </step>
    <step number="5b">
      <text xml:lang="en">If storage has available space → proceed to step 6</text>
      <text xml:lang="de">Wenn Speicher verfügbaren Platz hat → fahren Sie mit Schritt 6 fort</text>
    </step>
    <step number="6">
      <text xml:lang="en">Secure Element performs requested storage write operation</text>
      <text xml:lang="de">Secure Element führt angeforderte Speicherschreiboperation aus</text>
    </step>
    <step number="6a">
      <text xml:lang="en">If storage fills during write → ErrorStorageMemoryFull raised, write may be rolled back</text>
      <text xml:lang="de">Wenn Speicher während des Schreibens vollLäuft → ErrorStorageMemoryFull ausgelöst, Schreiben kann zurückgerollt werden</text>
    </step>
    <step number="6b">
      <text xml:lang="en">If storage write succeeds → proceed to step 7</text>
      <text xml:lang="de">Wenn Speicherschreiben erfolgreich ist → fahren Sie mit Schritt 7 fort</text>
    </step>
    <step number="7">
      <text xml:lang="en">Secure Element confirms write completion</text>
      <text xml:lang="de">Secure Element bestätigt Schreibabschluss</text>
    </step>
    <step number="8">
      <text xml:lang="en">Secure Element returns result to function</text>
      <text xml:lang="de">Secure Element gibt Ergebnis an die Funktion zurück</text>
    </step>
    <step number="9">
      <text xml:lang="en">Function processes result and returns to caller</text>
      <text xml:lang="de">Funktion verarbeitet Ergebnis und kehrt zum Aufrufer zurück</text>
    </step>
  </executionSequence>
  <recovery>
    <step>
      <text xml:lang="en">Check used and free memory using getUsedMemory and getFreeMemory</text>
      <text xml:lang="de">Prüfen Sie den verwendeten und freien Speicher mit getUsedMemory und getFreeMemory</text>
    </step>
    <step>
      <text xml:lang="en">Export and delete old log messages to free space</text>
      <text xml:lang="de">Exportieren und löschen Sie alte Log-Messages, um Platz freizugeben</text>
    </step>
    <step>
      <text xml:lang="en">Archive data externally to reduce device storage usage</text>
      <text xml:lang="de">Archivieren Sie Daten extern, um die Speichernutzung des Geräts zu verringern</text>
    </step>
    <step>
      <text xml:lang="en">Plan data management to prevent storage full conditions</text>
      <text xml:lang="de">Planen Sie die Datenverwaltung, um Speicher-voll-Bedingungen zu vermeiden</text>
    </step>
    <step>
      <text xml:lang="en">If necessary, migrate to device with larger storage</text>
      <text xml:lang="de">Bei Bedarf zu einem Gerät mit größerem Speicher migrieren</text>
    </step>
  </recovery>
  <relatedExceptions>
    <exception>ErrorFunctionFailed</exception>
    <exception>ErrorNoDataAvailable</exception>
    <exception>ErrorLimitOfSimultaneousOpenTransactionsReached</exception>
    <exception>ErrorStorageMediumDisconnected</exception>
  </relatedExceptions>
  <postconditionality>
    <state name="Storage Write Not Performed">
      <text xml:lang="en">The requested storage write operation is not completed.</text>
      <text xml:lang="de">Die angeforderte Speicherschreiboperation wird nicht abgeschlossen.</text>
    </state>
    <state name="Data Not Stored">
      <text xml:lang="en">New data is not stored on the device.</text>
      <text xml:lang="de">Neue Daten werden nicht auf dem Gerät gespeichert.</text>
    </state>
    <state name="Transaction Not Recorded">
      <text xml:lang="en">Transaction logs are not recorded when storage is full.</text>
      <text xml:lang="de">Transaktionsprotokolle werden nicht aufgezeichnet, wenn der Speicher voll ist.</text>
    </state>
    <state name="Storage Capacity Unchanged">
      <text xml:lang="en">Storage remains full - no free space is created.</text>
      <text xml:lang="de">Der Speicher bleibt voll - es wird kein freier Platz erstellt.</text>
    </state>
    <state name="Configuration Not Updated">
      <text xml:lang="en">Configuration changes cannot be stored when storage is full.</text>
      <text xml:lang="de">Konfigurationschanges können nicht gespeichert werden, wenn der Speicher voll ist.</text>
    </state>
    <state name="Manual Intervention Required">
      <text xml:lang="en">Storage management (export, delete) is needed to free space.</text>
      <text xml:lang="de">Speicherverwaltung (Export, Löschung) ist erforderlich, um Platz freizugeben.</text>
    </state>
  </postconditionality>
  <notes>
    <note>
      <text xml:lang="en">Indication: Storage memory is full - no space available for new data</text>
      <text xml:lang="de">Anzeichen: Speicher ist voll - kein Platz für neue Daten verfügbar</text>
    </note>
    <note>
      <text xml:lang="en">Topics: Storage Operations, Memory Management, Storage Capacity, Resource Limits</text>
      <text xml:lang="de">Themen: Speicheroperationen, Speicherverwaltung, Speicherkapazität, Ressourcenlimits</text>
    </note>
  </notes>
  <usage>
    <scenario name="Scenario 1: Storage Full During Peak Transaction Load">
      <description>
        <text xml:lang="en">A high-volume transaction system reaches storage full during peak load. A finishTransaction call raises ErrorStorageMemoryFull. Emergency storage cleanup procedures export and delete old logs, freeing space. Operations resume after storage cleanup.</text>
        <text xml:lang="de">Ein hochvolumiges Transaktionssystem erreicht vollen Speicher während der Spitzenlast. Ein finishTransaction-Aufruf löst ErrorStorageMemoryFull aus. Notfall-Speicherbereinigungsverfahren exportieren und löschen alte Protokolle und geben Platz frei. Operationen werden nach der Speicherbereinigung fortgesetzt.</text>
      </description>
      <relatedFunctions>finishTransaction, startTransaction, exportLogMessages, deleteLogMessages</relatedFunctions>
      <errorContext>
        <text xml:lang="en">Production transaction processing blocked by full storage during peak load</text>
        <text xml:lang="de">Produktions-Transaktionsverarbeitung durch vollen Speicher während der Spitzenlast blockiert</text>
      </errorContext>
    </scenario>
    <scenario name="Scenario 2: Proactive Storage Management">
      <description>
        <text xml:lang="en">A monitoring system tracks storage utilization. When storage reaches 80% capacity, the system automatically exports logs and deletes archived entries. This proactive approach prevents ErrorStorageMemoryFull during operations.</text>
        <text xml:lang="de">Ein Überwachungssystem verfolgt die Speichernutzung. Wenn der Speicher 80% Kapazität erreicht, exportiert das System automatisch Protokolle und löscht archivierte Einträge. Dieser proaktive Ansatz verhindert ErrorStorageMemoryFull während der Operationen.</text>
      </description>
      <relatedFunctions>getTotalMemory, getUsedMemory, getFreeMemory, exportLogMessages, deleteLogMessages</relatedFunctions>
      <errorContext>
        <text xml:lang="en">Proactive storage management prevents storage full conditions</text>
        <text xml:lang="de">Proaktive Speicherverwaltung verhindert Speicher-voll-Bedingungen</text>
      </errorContext>
    </scenario>
    <scenario name="Scenario 3: Storage Capacity Upgrade Triggered">
      <description>
        <text xml:lang="en">A system experiences ErrorStorageMemoryFull frequently despite regular log export. Analysis shows storage capacity is inadequate for the transaction workload. Device is upgraded with larger storage or storage management is improved.</text>
        <text xml:lang="de">Ein System erfährt ErrorStorageMemoryFull häufig trotz regelmäßigen Log-Exports. Die Analyse zeigt, dass die Speicherkapazität für die Transaktionsarbeitslast unzureichend ist. Das Gerät wird mit größerem Speicher aktualisiert oder die Speicherverwaltung wird verbessert.</text>
      </description>
      <relatedFunctions>startTransaction, getTotalMemory</relatedFunctions>
      <errorContext>
        <text xml:lang="en">Repeated storage full errors trigger storage capacity upgrade decision</text>
        <text xml:lang="de">Wiederholte Speicher-voll-Fehler lösen Entscheidung zur Speicherkapazitäts-Aufruestung aus</text>
      </errorContext>
    </scenario>
    <scenario name="Scenario 4: Log Restoration Blocked by Full Storage">
      <description>
        <text xml:lang="en">A restoreLogsFromBackup call to restore archived logs fails because storage is already full. The system must first export and delete current logs to free space, then retry the restore operation.</text>
        <text xml:lang="de">Ein restoreLogsFromBackup-Aufruf zur Wiederherstellung archivierter Protokolle schlägt fehl, da der Speicher bereits voll ist. Das System muss zuerst aktuelle Protokolle exportieren und löschen, um Platz freizugeben, und dann den Wiederherstellungsvorgang wiederholen.</text>
      </description>
      <relatedFunctions>restoreLogsFromBackup, exportLogMessages, deleteLogMessages</relatedFunctions>
      <errorContext>
        <text xml:lang="en">Log restoration requires storage space to be freed first</text>
        <text xml:lang="de">Log-Wiederherstellung erfordert, dass Speicherplatz zuerst freigegeben wird</text>
      </errorContext>
    </scenario>
  </usage>
  <implementationContext>
    <note>
      <text xml:lang="en">Raised by functions when device storage capacity exhausted</text>
      <text xml:lang="de">Wird von Funktionen ausgelöst, wenn die Gerätespeicherkapazität erschöpft ist</text>
    </note>
    <note>
      <text xml:lang="en">Storage capacity monitoring detects full condition</text>
      <text xml:lang="de">SpeicherkapazitätsÜberwachung erkennt Voll-Bedingung</text>
    </note>
    <note>
      <text xml:lang="en">Device cannot accept new data when storage full</text>
      <text xml:lang="de">Das Gerät kann keine neuen Daten akzeptieren, wenn der Speicher voll ist</text>
    </note>
    <note>
      <text xml:lang="en">Full condition prevents write operations</text>
      <text xml:lang="de">Voll-Bedingung verhindert Schreibvorgänge</text>
    </note>
  </implementationContext>
</exception>

