<?xml version='1.0' encoding='UTF-8' standalone='yes'?>
<exception xmlns="http://bsi.bund.de/TR03151" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="ErrorGetMaxNumberOfClientsFailed" xsi:schemaLocation="http://bsi.bund.de/TR03151 ../../schema/exceptions.xsd">
  <name>ErrorGetMaxNumberOfClientsFailed</name>
  <description>This exception is thrown if the SE API function getMaxNumberOfClients fails to retrieve the maximum number of clients that can simultaneously use the Secure Element. The function attempts to determine the device's client capacity limit, but the retrieval process fails before the capacity value can be determined and returned.</description>
  <category>Client Management</category>
  <subcategory>Capacity Query</subcategory>
  <severity>Medium</severity>
  <javadoc>
    <summary>This class defines the exception ErrorGetMaxNumberOfClientsFailed that is thrown if the determination of the maximum number of clients that could use the SE API simultaneously failed.</summary>
    <description>This exception is thrown when the getMaxNumberOfClients function cannot retrieve the maximum client capacity from the Secure Element. The maximum number of clients represents the upper limit on concurrent client connections that the device can simultaneously serve. ErrorGetMaxNumberOfClientsFailed indicates that the Secure Element cannot provide the client capacity information due to hardware failure, storage corruption, internal client management system errors, communication failures, or Secure Element state restrictions. When this exception occurs, no capacity data is returned and applications cannot determine the device's maximum client limit or assess client connection capacity. Recovery typically involves device verification, client management subsystem diagnostics, and possible hardware diagnosis if the failure persists.</description>
  </javadoc>
  <specification>
    <source>BSI TR-03151-1</source>
    <section>3.2.1 Client Management - getMaxNumberOfClients</section>
    <requirement>The function getMaxNumberOfClients SHALL query the Secure Element to determine the maximum number of clients that can simultaneously use the SE API. If the Secure Element cannot provide or return the required capacity information, the function SHALL raise the exception ErrorGetMaxNumberOfClientsFailed and exit without returning any capacity data. The maximum client capacity retrieval failure indicates the Secure Element's client capacity query functionality could not complete successfully.</requirement>
    <applicability>Client management operations - getMaxNumberOfClients function only</applicability>
    <reference>getMaxNumberOfClients – Function (3.2.1)</reference>
  </specification>
  <thrownBy>
    <function>getMaxNumberOfClients</function>
  </thrownBy>
  <triggerConditions>
    <condition>
      <scenario>Client capacity configuration storage hardware failure</scenario>
      <description>The Secure Element's client capacity configuration storage hardware malfunctions or becomes inaccessible, preventing capacity value retrieval</description>
      <trigger>The Secure Element's capacity configuration storage hardware fails or experiences read errors. When getMaxNumberOfClients is called, the capacity query is sent to the Secure Element, but the hardware cannot provide valid capacity data. The function receives a failure status from the Secure Element, triggering ErrorGetMaxNumberOfClientsFailed.</trigger>
    </condition>
    <condition>
      <scenario>Client management configuration data corruption</scenario>
      <description>The Secure Element's client management configuration or capacity specification data becomes corrupted or is lost</description>
      <trigger>The Secure Element's memory containing client capacity configuration or client management data becomes corrupted, experiences data loss, or is marked as inaccessible due to storage errors. When getMaxNumberOfClients attempts to read capacity configuration from storage, the data cannot be reliably retrieved, triggering ErrorGetMaxNumberOfClientsFailed.</trigger>
    </condition>
    <condition>
      <scenario>Client management subsystem internal error</scenario>
      <description>The Secure Element's client management subsystem encounters critical errors that prevent client capacity information retrieval</description>
      <trigger>The Secure Element's client management subsystem (responsible for managing client connections and providing client capacity information) encounters an internal error, deadlock, or exception. When getMaxNumberOfClients is called, the client management system cannot process the capacity query, triggering ErrorGetMaxNumberOfClientsFailed.</trigger>
    </condition>
    <condition>
      <scenario>Device-to-Secure Element communication failure during capacity query</scenario>
      <description>The communication channel between device and Secure Element is disrupted during client capacity retrieval</description>
      <trigger>A communication failure occurs while getMaxNumberOfClients transmits the capacity query to the Secure Element or while receiving the capacity response. The command may be corrupted, the response may be incomplete, or the communication link may be temporarily unavailable. The function receives a communication error status, triggering ErrorGetMaxNumberOfClientsFailed.</trigger>
    </condition>
    <condition>
      <scenario>Secure Element in restricted or error state prohibiting capacity access</scenario>
      <description>The Secure Element is in a locked, restricted, or error state that prevents external queries for client capacity information</description>
      <trigger>The Secure Element enters a state where client management queries or client capacity access is not permitted. When getMaxNumberOfClients is called and the Secure Element's state prohibits capacity access, the function receives a state-related rejection, triggering ErrorGetMaxNumberOfClientsFailed.</trigger>
    </condition>
  </triggerConditions>
  <executionSequence>
    <step number="1">User/application calls getMaxNumberOfClients function on device</step>
    <step number="2">Function validates input parameters and checks authentication status (if required by referencing guideline)</step>
    <step number="3">Function checks authorization for client management information access (if required by referencing guideline)</step>
    <step number="4">Function verifies device is properly initialized and client management is operational</step>
    <step number="5">Function initiates communication channel to Secure Element and prepares capacity query command</step>
    <step number="6">Function transmits capacity query command to Secure Element requesting maximum client capacity</step>
    <step number="6a">If Secure Element responds with failure status (configuration error, capacity retrieval error, management error) → ErrorGetMaxNumberOfClientsFailed raised, function exits without capacity data</step>
    <step number="6b">If communication failure occurs during query transmission or response reception → ErrorGetMaxNumberOfClientsFailed raised, function exits</step>
    <step number="7">If successful, function receives maximum client capacity from Secure Element</step>
    <step number="8">Function validates capacity value for correctness (format, numeric range, logical consistency)</step>
    <step number="9">Function closes Secure Element communication channel</step>
    <step number="10">Function returns valid maximum client capacity to caller</step>
  </executionSequence>
  <recovery>
    <step>Verify device is initialized</step>
    <step>Confirm Secure Element is operational</step>
    <step>Retry capacity query operation</step>
    <step>Check device specification for client limits</step>
  </recovery>
  <relatedExceptions>
    <exception>ErrorFunctionFailed</exception>
    <exception>ErrorDeviceNotInitialized</exception>
    <exception>ErrorClientLimitReached</exception>
    <exception>ErrorGetCurrentNumberOfClientsFailed</exception>
    <exception>ErrorClientNotRegistered</exception>
  </relatedExceptions>
  <postconditionality>
    <state name="Device Operational State">Device remains fully operational and unmodified. The failure to retrieve maximum client capacity does not affect device initialization state, client management operations, internal memory, stored data, or the ability to perform other operations. All device components remain in their pre-call state.</state>
    <state name="Capacity Data Return Status">No capacity value is returned to the caller. The function exits without providing any maximum client capacity information. Applications must not assume default capacity values or cached information; they must handle the exception as indicating capacity information is unavailable.</state>
    <state name="Secure Element Client Management State">Secure Element client management subsystem remains unchanged by the failed capacity query. No state modifications, client limit changes, or client management configuration changes occur. Client management continues normally regardless of the retrieval failure.</state>
    <state name="Client Capacity Continuity">The Secure Element continues to maintain accurate client capacity limits internally. The failure to retrieve maximum capacity does not affect the actual capacity limit or client management operations. Capacity queries can be retried once the underlying issue is resolved.</state>
    <state name="No Cascading State Effects">No cascading state inconsistencies or secondary failures occur as a result of the capacity query failure. Device internal consistency is maintained. Other SE API functions and client management operations continue normally without state corruption.</state>
    <state name="Recovery Preconditions Met">The device state after exception is consistent and allows for recovery operations. The underlying issue (hardware error, communication error, management system error) remains present, but the device is stable enough to accept diagnostic queries or recovery attempts.</state>
  </postconditionality>
  <notes>
    <note>Indication: Retrieval of maximum client count failed - capacity limit unknown</note>
    <note>Topics: Client Management, Device Limits, Resource Management, Capacity Information</note>
  </notes>
  <usage>
    <scenario name="Scenario 1: Client Capacity Planning Before Multi-Client Deployment">
      <description>An enterprise prepares to deploy an application that will serve multiple clients simultaneously through the SE API. The deployment planning process queries getMaxNumberOfClients to determine how many concurrent clients the device can support. If ErrorGetMaxNumberOfClientsFailed is raised, the deployment planning cannot determine device client capacity and must defer deployment or use conservative capacity estimates.</description>
      <relatedFunctions>getMaxNumberOfClients, getCurrentNumberOfClients, registerClient</relatedFunctions>
      <errorContext>Maximum client capacity unavailable for deployment capacity planning</errorContext>
    </scenario>
    <scenario name="Scenario 2: Runtime Client Capacity Monitoring and Connection Admission Control">
      <description>A runtime system monitors active client connections and enforces client capacity limits. When new client connection requests arrive, the system queries getMaxNumberOfClients to determine the capacity limit and decides whether to admit new clients. If ErrorGetMaxNumberOfClientsFailed is raised, the system cannot determine capacity limits and must conservatively reject new client connections.</description>
      <relatedFunctions>getMaxNumberOfClients, getCurrentNumberOfClients, registerClient</relatedFunctions>
      <errorContext>Maximum client capacity unavailable for connection admission control</errorContext>
    </scenario>
    <scenario name="Scenario 3: Multi-Device Client Capacity Assessment and Load Distribution">
      <description>A load balancing system distributes client connections across multiple devices to optimize utilization and prevent capacity overload. The system queries getMaxNumberOfClients on each device to understand device capacity and determine optimal load distribution. If ErrorGetMaxNumberOfClientsFailed is raised on one device, the system cannot determine that device's capacity and must exclude it from load distribution until capacity can be determined.</description>
      <relatedFunctions>getMaxNumberOfClients, getCurrentNumberOfClients, registerClient</relatedFunctions>
      <errorContext>Maximum client capacity unavailable for multi-device load distribution</errorContext>
    </scenario>
    <scenario name="Scenario 4: Device Provisioning and Configuration Documentation">
      <description>A device provisioning system collects device configuration information for deployment documentation and capacity planning. The system queries getMaxNumberOfClients to document the device's client connection capacity in configuration records. If ErrorGetMaxNumberOfClientsFailed is raised, the system cannot complete the device configuration documentation.</description>
      <relatedFunctions>getMaxNumberOfClients, getCurrentNumberOfClients, getVersion, getSerialNumber</relatedFunctions>
      <errorContext>Maximum client capacity unavailable for device provisioning documentation</errorContext>
    </scenario>
  </usage>
  <implementationContext>
    <note>Raised by getMaxNumberOfClients when capacity limit retrieval fails</note>
    <note>Capacity function queries maximum supported registered clients</note>
    <note>Device specifies configured client registry capacity</note>
    <note>Retrieval failure prevents capacity information access</note>
  </implementationContext>
</exception>

