<?xml version='1.0' encoding='UTF-8' standalone='yes'?>
<exception xmlns="http://bsi.bund.de/TR03151" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="ErrorDeleteLogMessagesFailed" xsi:schemaLocation="http://bsi.bund.de/TR03151 ../../schema/exceptions.xsd">
  <name>ErrorDeleteLogMessagesFailed</name>
  <description>This exception is thrown if the deletion of log messages from the storage failed during execution of the deleteLogMessages function. The exception represents a critical failure in the device's ability to remove stored log messages from the logging storage subsystem. ErrorDeleteLogMessagesFailed is raised when the device attempts to delete log message files that have been previously exported and marked for deletion, but encounters an I/O error, storage access issue, or system-level failure that prevents successful removal. This exception indicates that the device's storage subsystem has rejected the deletion request due to hardware errors, file system inconsistencies, permission violations, or physical disconnection of the storage medium. The exception is raised after the device has validated deletion prerequisites but failed during the actual removal of log data from persistent storage.</description>
  <category>Logging</category>
  <subcategory>Deletion</subcategory>
  <severity>High</severity>
  <javadoc>
    <summary>This class defines the exception ErrorDeleteLogMessagesFailed that is thrown if the deletion of log messages from the storage failed.</summary>
    <description>The deletion operation of log messages from the device storage encountered a failure condition. This exception indicates that the deleteLogMessages function was unable to successfully remove stored log messages. This failure may be due to storage access issues, insufficient permissions, or system-level I/O errors during the deletion process.</description>
  </javadoc>
  <specification>
    <source>BSI TR-03151-1</source>
    <section>3.6.4.4</section>
    <requirement>SHALL be raised when the deletion of log message files from the storage fails. If the deletion of the data fails, the function SHALL raise the exception ErrorDeleteLogMessagesFailed and exit the function.</requirement>
    <applicability>Log message deletion operations when storage removal fails</applicability>
    <reference>deleteLogMessages â€“ Exceptions (3.6.4.4)</reference>
  </specification>
  <thrownBy>
    <function>deleteLogMessages</function>
  </thrownBy>
  <triggerConditions>
    <condition>
      <scenario>Storage medium I/O error during deletion operation</scenario>
      <description>The device initiates deletion of log message files, but the storage medium encounters a read-modify-write error, CRC failure, or other I/O error that prevents successful file removal. The error may originate from hardware malfunction, firmware issues, or storage medium degradation.</description>
      <trigger>I/O error or storage hardware failure during file deletion operation</trigger>
    </condition>
    <condition>
      <scenario>Storage medium disconnection or unavailability</scenario>
      <description>The storage medium becomes disconnected, unavailable, or inaccessible during the deletion operation. This can occur if an external storage device is physically removed, a network storage connection is lost, or the storage subsystem enters an offline state.</description>
      <trigger>Storage medium becomes inaccessible during deletion</trigger>
    </condition>
    <condition>
      <scenario>File system corruption or inconsistency</scenario>
      <description>The device's file system containing the log messages has become corrupted, inconsistent, or damaged. The file system cannot locate the log message files to be deleted, or the file system metadata is too corrupted to perform deletion operations.</description>
      <trigger>File system corruption preventing file deletion</trigger>
    </condition>
    <condition>
      <scenario>Permission or access control violation</scenario>
      <description>The deletion operation is attempted on log message files, but the operating system or security subsystem denies the deletion due to permission restrictions, file locks held by other processes, or security policy enforcement.</description>
      <trigger>Insufficient permissions or access restrictions preventing deletion</trigger>
    </condition>
    <condition>
      <scenario>Storage capacity or resource exhaustion</scenario>
      <description>The device's storage system has entered a state where deletion operations cannot proceed due to insufficient resources, file system journal space exhaustion, or transaction log overflow that prevents recording the deletion operation.</description>
      <trigger>Storage resource exhaustion preventing deletion completion</trigger>
    </condition>
  </triggerConditions>
  <recovery>
    <step>Verify device is initialized and has accessible storage</step>
    <step>Check that log messages exist using appropriate query functions</step>
    <step>Ensure all messages are exported before deletion attempts</step>
    <step>Retry deletion operation after confirming preconditions</step>
    <step>Review device storage status and available capacity</step>
  </recovery>
  <relatedExceptions>
    <exception>ErrorStoringLogMessageFailed</exception>
    <exception>ErrorRetrieveLogMessageFailed</exception>
    <exception>ErrorUnexportedLogMessages</exception>
    <exception>ErrorStorageMediumDisconnected</exception>
  </relatedExceptions>
  <executionSequence>
    <step number="1" name="Function Invocation">Function entry point is reached with parameters specifying the log message selection criteria (date range, clientId, transaction id, or other filters)</step>
    <step number="2" name="Parameter Validation">The Secure Element validates that filter parameters are valid and correspond to supported filtering criteria</step>
    <step number="3" name="Pre-deletion Checks">The device performs preliminary checks to verify that deletion preconditions are met, such as verifying all matching log messages have been exported if required by device policy</step>
    <step number="4" name="Storage Access Acquisition">The device acquires access to the storage subsystem and initiates a transaction for safe log message deletion</step>
    <step number="5" name="Log Message Location">The device locates log message files matching the specified filter criteria in the storage medium</step>
    <step number="6" name="Deletion Attempt">The device attempts to delete located log message files through file system operations on the storage medium</step>
    <step number="7a" name="Deletion Success">If deletion completes successfully, execution continues to transaction commit and function completion (not taken in this exception case)</step>
    <step number="7b" name="Deletion Failure">If the storage medium or file system returns an error during deletion, execution branches to exception handling at step 8</step>
    <step number="8" name="Transaction Rollback">The device attempts to rollback the deletion transaction to restore consistency, though some storage systems may not support transactional deletion</step>
    <step number="9" name="Exception Context Preparation">Exception context is prepared including filter criteria, number of messages targeted for deletion, storage error details, and device state information</step>
    <step number="10" name="Exception Instance Creation">ErrorDeleteLogMessagesFailed exception instance is created with appropriate error message detailing the storage deletion failure</step>
    <step number="11" name="Exception Propagation">Exception is raised and propagated up the call stack to the calling application, allowing error handling and recovery at application level</step>
  </executionSequence>
  <postconditionality>
    <state name="Exception State">An ErrorDeleteLogMessagesFailed exception has been created and raised, containing filter criteria, targeted message count, and storage error details</state>
    <state name="Log Message State">The log messages targeted for deletion remain in storage unchanged. Deletion has not been successfully completed. Depending on device implementation, some messages may be partially deleted or marked for deletion but not fully removed.</state>
    <state name="Storage State">The storage medium and file system remain in their previous state, with all targeted log messages still present and accessible. Storage space has not been freed for the messages targeted for deletion.</state>
    <state name="Transaction State">If the device supports transactional deletion, the deletion transaction has been rolled back and the storage is returned to its pre-deletion state. If transactions are not supported, storage state is indeterminate.</state>
    <state name="Function Exit">The function exits abnormally via exception propagation without completing the log message deletion operation</state>
    <state name="Device Availability">The Secure Element and logging subsystem remain available for subsequent API calls, though the storage error condition may persist and affect future delete operations. The device continues to operate, but with the storage issue unresolved.</state>
  </postconditionality>
  <notes>
    <note>Indication: Deletion of log messages failed - log data could not be removed</note>
    <note>Topics: Logging Operations, Data Deletion, Log Management, Storage Operations</note>
  </notes>
  <usage>
    <scenario name="Scenario 1: Storage Medium Disconnection During Deletion">
      <description>An application initiates deletion of log messages to free storage space, but the external storage medium becomes disconnected during the deletion operation, causing this exception.</description>
      <relatedFunctions>deleteLogMessages, exportLogMessages, getDeviceHealth</relatedFunctions>
      <errorContext>Hardware connectivity failure during log message deletion operation</errorContext>
    </scenario>
    <scenario name="Scenario 2: File System Corruption Detection">
      <description>Repeated deletion operations have been succeeding, but after a device crash or power cycle, subsequent deletion attempts fail due to file system corruption, indicating the need for storage recovery.</description>
      <relatedFunctions>deleteLogMessages, exportLogMessages, initializeDevice</relatedFunctions>
      <errorContext>Storage integrity issue manifesting as repeated deletion failures after device recovery</errorContext>
    </scenario>
    <scenario name="Scenario 3: Gradual Storage Degradation">
      <description>A device gradually accumulates storage errors over time. Initially storage is reliable, but as storage medium ages, deletion operations begin failing intermittently, indicating hardware degradation.</description>
      <relatedFunctions>deleteLogMessages, getComponentVersions, getDeviceHealth</relatedFunctions>
      <errorContext>Progressive hardware failure where storage becomes increasingly unreliable</errorContext>
    </scenario>
    <scenario name="Scenario 4: Permission Violation in Secure Environment">
      <description>In a multi-tenant or secure environment, a deletion attempt fails because the requesting principal lacks sufficient permissions to delete log messages owned by other principals or sensitive system components.</description>
      <relatedFunctions>deleteLogMessages, exportLogMessages, getDeviceHealth</relatedFunctions>
      <errorContext>Access control and permission enforcement during log deletion</errorContext>
    </scenario>
  </usage>
  <implementationContext>
    <note>Raised by deleteLogMessages when message deletion operation fails</note>
    <note>Log deletion subsystem removes stored log messages from device storage</note>
    <note>Operation may fail due to storage issues or message state conflicts</note>
    <note>Device maintains log integrity during deletion attempts</note>
  </implementationContext>
</exception>

