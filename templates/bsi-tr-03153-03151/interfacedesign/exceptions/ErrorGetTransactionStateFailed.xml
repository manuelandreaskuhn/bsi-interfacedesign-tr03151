<?xml version='1.0' encoding='UTF-8' standalone='yes'?>
<exception xmlns="http://bsi.bund.de/TR03151" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="ErrorGetTransactionStateFailed" xsi:schemaLocation="http://bsi.bund.de/TR03151 ../../schema/exceptions.xsd">
  <name>ErrorGetTransactionStateFailed</name>
  <description>
    <text xml:lang="en">This exception is thrown if the SE API function getTransactionState fails to retrieve the current state of a specific transaction. The function attempts to determine the operational state of an active transaction, but the retrieval process fails before the transaction state can be determined and returned.</text>
    <text xml:lang="de">Diese Ausnahme wird ausgelöst, wenn die SE API Funktion getTransactionState fehlschlägt, um den aktuellen Status einer bestimmten Transaktion abzurufen. Die Funktion versucht, den Betriebszustand einer aktiven Transaktion zu bestimmen, aber der Abrufprozess schlägt fehl, bevor der Transaktionsstatus bestimmt und zurückgegeben werden kann.</text>
  </description>
  <category>Transaction Management</category>
  <subcategory>Transaction State Query</subcategory>
  <severity>High</severity>
  <javadoc>
    <summary>
      <text xml:lang="en">This class defines the exception ErrorGetTransactionStateFailed that is thrown if the determination of the transaction state failed.</text>
      <text xml:lang="de">Diese Klasse definiert die Ausnahme ErrorGetTransactionStateFailed, die ausgelöst wird, wenn die Bestimmung des Transaktionsstatus fehlgeschlagen ist.</text>
    </summary>
    <description>
      <text xml:lang="en">This exception is thrown when the getTransactionState function cannot retrieve the current state of a specific transaction from the Secure Element. Transaction state information describes the operational status of an active transaction (active, pending completion, suspended, etc.). ErrorGetTransactionStateFailed indicates that the Secure Element cannot provide the transaction state due to hardware failure, transaction state storage corruption, internal transaction management system errors, communication failures, or Secure Element state restrictions. When this exception occurs, no transaction state value is returned and applications cannot determine the operational status of the requested transaction. Recovery typically involves transaction diagnostics, transaction management subsystem verification, and state recovery if the failure persists.</text>
      <text xml:lang="de">Diese Ausnahme wird ausgelöst, wenn die Funktion getTransactionState den aktuellen Status einer bestimmten Transaktion nicht vom Secure Element abrufen kann. Die Transaktionsstatus-Information beschreibt den Betriebszustand einer aktiven Transaktion (aktiv, ausstehend, unterbrochen, usw.). ErrorGetTransactionStateFailed zeigt an, dass das Secure Element den Transaktionsstatus aufgrund eines Hardware-Ausfalls, Speicherbeschädigung des Transaktionsstatus, interner Transaktionsmanagement-Systemfehler, Kommunikationsfehler oder Secure Element Zustandsbeschränkungen nicht bereitstellen kann. Wenn diese Ausnahme auftritt, wird kein Transaktionsstatus-Wert zurückgegeben und Anwendungen können den Betriebszustand der angeforderten Transaktion nicht bestimmen. Die Wiederherstellung umfasst normalerweise Transaktionsdiagnose, Transaktionsmanagement-Subsystem-Verifizierung und Zustandswiederherstellung, wenn der Fehler anhält.</text>
    </description>
  </javadoc>
  <specification>
    <source>BSI TR-03151-1</source>
    <section>3.1.5 Transaction Management - getTransactionState</section>
    <requirement>
      <text xml:lang="en">The function getTransactionState SHALL query the Secure Element to determine the current state of a specific transaction. If the Secure Element cannot provide or return the required transaction state information, the function SHALL raise the exception ErrorGetTransactionStateFailed and exit without returning any state data. The transaction state retrieval failure indicates the Secure Element's transaction management query functionality could not complete successfully.</text>
      <text xml:lang="de">Die Funktion getTransactionState soll das Secure Element abfragen, um den aktuellen Status einer bestimmten Transaktion zu bestimmen. Falls das Secure Element die erforderlichen Transaktionsstatus-Informationen nicht bereitstellen oder zurückgeben kann, soll die Funktion die Ausnahme ErrorGetTransactionStateFailed auslösen und beenden, ohne Statusdaten zurückzugeben. Das Abruffehler für den Transaktionsstatus zeigt an, dass die Abfragefunktionalität des Transaktionsmanagements des Secure Element nicht erfolgreich abgeschlossen werden konnte.</text>
    </requirement>
    <applicability>
      <text xml:lang="en">Transaction management operations - getTransactionState function only</text>
      <text xml:lang="de">Transaktionsmanagement-Operationen - nur Funktion getTransactionState</text>
    </applicability>
    <reference>getTransactionState – Function (3.1.5)</reference>
  </specification>
  <thrownBy>
    <function>getTransactionState</function>
  </thrownBy>
  <executionSequence>
    <step number="1">
      <text xml:lang="en">User/application calls getTransactionState function with transaction ID parameter on device</text>
      <text xml:lang="de">Benutzer/Anwendung ruft die Funktion getTransactionState mit Transaktions-ID-Parameter auf dem Gerät auf</text>
    </step>
    <step number="2">
      <text xml:lang="en">Function validates input parameters (transaction ID validity) and checks authentication status (if required by referencing guideline)</text>
      <text xml:lang="de">Funktion validiert Eingabeparameter (Transaktions-ID-Gültigkeit) und prüft Authentifizierungsstatus (falls von Richtlinie erforderlich)</text>
    </step>
    <step number="3">
      <text xml:lang="en">Function checks authorization for transaction information access (if required by referencing guideline)</text>
      <text xml:lang="de">Funktion prüft die Autorisierung für den Transaktions-Informationszugriff (falls von Richtlinie erforderlich)</text>
    </step>
    <step number="4">
      <text xml:lang="en">Function verifies device is properly initialized and transaction management is operational</text>
      <text xml:lang="de">Funktion verifiziert, dass das Gerät ordnungsgemäß initialisiert und das Transaktionsmanagement betriebsbereit ist</text>
    </step>
    <step number="5">
      <text xml:lang="en">Function initiates communication channel to Secure Element and prepares transaction state query command with transaction ID</text>
      <text xml:lang="de">Funktion initiiert Kommunikationskanal zu Secure Element und bereitet Transaktionsstatus-Abfrage-Befehl mit Transaktions-ID vor</text>
    </step>
    <step number="6">
      <text xml:lang="en">Function transmits state query command to Secure Element requesting the current state of the specified transaction</text>
      <text xml:lang="de">Funktion übersendet Statusabfrage-Befehl zu Secure Element und fordert den aktuellen Status der angegebenen Transaktion an</text>
    </step>
    <step number="6a">
      <text xml:lang="en">If Secure Element responds with failure status (transaction error, state error, management error) → ErrorGetTransactionStateFailed raised, function exits without state value</text>
      <text xml:lang="de">Falls Secure Element mit Fehlerstatus antwortet (Transaktionsfehler, Statusfehler, Managementfehler) → ErrorGetTransactionStateFailed ausgelöst, Funktion beendet ohne Statuswert</text>
    </step>
    <step number="6b">
      <text xml:lang="en">If communication failure occurs during query transmission or response reception → ErrorGetTransactionStateFailed raised, function exits</text>
      <text xml:lang="de">Falls Kommunikationsfehler während Abfragetransmission oder Antwortempfang auftritt → ErrorGetTransactionStateFailed ausgelöst, Funktion beendet</text>
    </step>
    <step number="7">
      <text xml:lang="en">If successful, function receives transaction state value from Secure Element</text>
      <text xml:lang="de">Falls erfolgreich, empfängt Funktion Transaktionsstatus-Wert von Secure Element</text>
    </step>
    <step number="8">
      <text xml:lang="en">Function validates transaction state value for correctness (format, state validity, transaction existence verification)</text>
      <text xml:lang="de">Funktion validiert Transaktionsstatus-Wert auf Korrektheit (Format, Status-Gültigkeit, Transaktions-Existenz-Verifizierung)</text>
    </step>
    <step number="9">
      <text xml:lang="en">Function closes Secure Element communication channel</text>
      <text xml:lang="de">Funktion schließt Secure Element Kommunikationskanal</text>
    </step>
    <step number="10">
      <text xml:lang="en">Function returns valid transaction state value to caller</text>
      <text xml:lang="de">Funktion gibt gültigen Transaktionsstatus-Wert an Aufrufer zurück</text>
    </step>
  </executionSequence>
  <recovery>
    <step>
      <text xml:lang="en">Verify device is initialized</text>
      <text xml:lang="de">Stellen Sie sicher, dass das Gerät initialisiert ist</text>
    </step>
    <step>
      <text xml:lang="en">Confirm Secure Element is operational</text>
      <text xml:lang="de">Bestätigen Sie, dass das Secure Element betriebsbereit ist</text>
    </step>
    <step>
      <text xml:lang="en">Verify transaction number is valid and exists</text>
      <text xml:lang="de">Verifizieren Sie, dass die Transaktionsnummer gültig ist und existiert</text>
    </step>
    <step>
      <text xml:lang="en">Retry transaction state query after confirming preconditions</text>
      <text xml:lang="de">Wiederholen Sie die Transaktionsstatus-Abfrage nach Bestätigung der Vorbedingungen</text>
    </step>
  </recovery>
  <relatedExceptions>
    <exception>ErrorFunctionFailed</exception>
    <exception>ErrorDeviceNotInitialized</exception>
    <exception>ErrorTransactionNotFound</exception>
    <exception>ErrorGetOpenTransactionsFailed</exception>
    <exception>ErrorGetCurrentTransactionCounterFailed</exception>
  </relatedExceptions>
  <postconditionality>
    <state name="Device Operational State">
      <text xml:lang="en">Device remains fully operational and unmodified. The failure to retrieve transaction state does not affect device initialization state, transaction management operations, internal memory, stored data, or the ability to perform other operations. All device components remain in their pre-call state.</text>
      <text xml:lang="de">Das Gerät bleibt vollständig betriebsbereit und unmodifiziert. Das Fehlschlagen des Abrufs des Transaktionsstatus wirkt sich nicht auf den Geräteinitialisierungszustand, Transaktionsmanagement-Operationen, den internen Speicher, die gespeicherten Daten oder die Fähigkeit zur Durchführung anderer Operationen aus. Alle Gerätekomponenten bleiben in ihrem Pre-Call-Zustand.</text>
    </state>
    <state name="Transaction State Return Status">
      <text xml:lang="en">No transaction state value is returned to the caller. The function exits without providing transaction operational status. Applications must not assume default transaction states or cached information; they must handle the exception as indicating transaction state information is unavailable.</text>
      <text xml:lang="de">Es wird kein Transaktionsstatus-Wert an den Aufrufer zurückgegeben. Die Funktion wird beendet, ohne Transaktionsbetriebs-Status bereitzustellen. Anwendungen dürfen nicht mit Standard-Transaktionsstatuswerten oder zwischengespeicherten Informationen rechnen; sie müssen die Ausnahme als Anzeichen dafür behandeln, dass Transaktionsstatus-Informationen nicht verfügbar sind.</text>
    </state>
    <state name="Secure Element Transaction Management State">
      <text xml:lang="en">Secure Element transaction management subsystem remains unchanged by the failed query. No state modifications, transaction state changes, or transaction management configuration changes occur. Transaction management operations continue normally regardless of the retrieval failure.</text>
      <text xml:lang="de">Das Transaktionsmanagement-Subsystem des Secure Element bleibt durch die fehlgeschlagene Abfrage unverändert. Es werden keine Zustandsänderungen, Transaktionsstaänderungen oder Transaktionsmanagement-Konfigurationänderungen vorgenommen. Transaktionsmanagement-Operationen funktionieren normal, unabhängig vom Abruffehler.</text>
    </state>
    <state name="Transaction Continuity">
      <text xml:lang="en">The specified transaction continues to be maintained internally in the Secure Element. The failure to retrieve the transaction state does not affect the transaction or transaction management operations. State queries can be retried once the underlying issue is resolved.</text>
      <text xml:lang="de">Die angegebene Transaktion wird intern im Secure Element weiterhin verwaltet. Das Fehlschlagen des Abrufs des Transaktionsstatus wirkt sich nicht auf die Transaktion oder Transaktionsmanagement-Operationen aus. Statusabfragen können wiederholt werden, sobald das zugrunde liegende Problem behoben ist.</text>
    </state>
    <state name="No Cascading State Effects">
      <text xml:lang="en">No cascading state inconsistencies or secondary failures occur as a result of the state query failure. Device internal consistency is maintained. Other SE API functions and transaction management operations continue normally without state corruption.</text>
      <text xml:lang="de">Es treten keine kaskadenförmigen Zustandsinkonsistenzen oder sekundäre Ausfälle als Ergebnis des Statusabfragefehlers auf. Die interne Konsistenz des Geräts wird aufrechterhalten. Andere SE API Funktionen und Transaktionsmanagement-Operationen funktionieren normal ohne Zustandsbeschädigung.</text>
    </state>
    <state name="Recovery Preconditions Met">
      <text xml:lang="en">The device state after exception is consistent and allows for recovery operations. The underlying issue (hardware error, communication error, management system error) remains present, but the device is stable enough to accept diagnostic queries or recovery attempts.</text>
      <text xml:lang="de">Der Gerätezustand nach der Ausnahme ist konsistent und ermöglicht Wiederherstellungsoperationen. Das zugrunde liegende Problem (Hardware-Fehler, Kommunikationsfehler, Managementsystem-Fehler) bleibt bestehen, aber das Gerät ist stabil genug, um Diagnoseversuche oder Wiederherstellungsversuche zu akzeptieren.</text>
    </state>
  </postconditionality>
  <notes>
    <note>
      <text xml:lang="en">Indication: Retrieval of transaction state failed - transaction information unavailable</text>
      <text xml:lang="de">Anzeichen: Abruf des Transaktionsstatus fehlgeschlagen - Transaktions-Informationen nicht verfügbar</text>
    </note>
    <note>
      <text xml:lang="en">Topics: Transaction Management, Information Retrieval, Transaction State, Transaction Status</text>
      <text xml:lang="de">Themen: Transaktionsmanagement, Informationsabruf, Transaktionsstatus, Transaktionszustand</text>
    </note>
  </notes>
  <implementationContext>
    <note>
      <text xml:lang="en">Raised by getTransactionState when transaction state retrieval fails</text>
      <text xml:lang="de">Wird von getTransactionState ausgelöst, wenn der Abruf des Transaktionsstatus fehlschlägt</text>
    </note>
    <note>
      <text xml:lang="en">Query function retrieves specific transaction state information</text>
      <text xml:lang="de">Abfragefunktion ruft spezifische Transaktionsstatus-Informationen ab</text>
    </note>
    <note>
      <text xml:lang="en">Device maintains detailed state for each transaction</text>
      <text xml:lang="de">Gerät verwaltet detaillierten Status für jede Transaktion</text>
    </note>
    <note>
      <text xml:lang="en">Retrieval failure prevents transaction state access</text>
      <text xml:lang="de">Abruffehler verhindert Transaktionsstatus-Zugriff</text>
    </note>
  </implementationContext>
</exception>

